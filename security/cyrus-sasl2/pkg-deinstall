#!/bin/sh
#
#	$FreeBSD$
#
# Created by: hetzels@westbend.net

#set -vx

PKG_BATCH=${BATCH:=NO}

PKG_PREFIX=${PKG_PREFIX:=/usr/local}

SASLDB_NAME=${PKG_PREFIX}/etc/%%SASLDB%%

# delete sasldb database

delete_sasldb() {
	if [ -f ${SASLDB_NAME} ] ; then
		if [ `${PKG_PREFIX}/sbin/sasldblistusers | wc -l` -eq 0 ] ; then
			rm ${SASLDB_NAME}
		else
			echo "WARNING: Users SASL passwords are in ${SASLDB_NAME}, keeping this file"
		fi
	fi
}

# This should really be uninstalled by Sendmail

sendmail_conf() {
	if [ -f ${PKG_PREFIX}/lib/sasl/Sendmail.conf ]; then
		echo "pwcheck_method: pwcheck" > ${PKG_PREFIX}/lib/sasl/Sendmail.conf.tmp
		if cmp -s ${PKG_PREFIX}/lib/sasl/Sendmail.conf ${PKG_PREFIX}/lib/sasl/Sendmail.conf.tmp; then
			rm -f ${PKG_PREFIX}/lib/sasl/Sendmail.conf
		fi
		rm -f ${PKG_PREFIX}/lib/sasl/Sendmail.conf.tmp
	fi
}

case $2 in
	DEINSTALL)
		delete_sasldb
		sendmail_conf
		;;
	POST-DEINSTALL)
		;;

esac
