PORTNAME=	libssh
DISTVERSION=	0.11.0
CATEGORIES=	security devel
MASTER_SITES=	https://www.libssh.org/files/${DISTVERSION:R}/

MAINTAINER=	sunpoet@FreeBSD.org
COMMENT=	Library implementing the SSH2 protocol
WWW=		https://www.libssh.org/

LICENSE=	LGPL21
LICENSE_FILE=	${WRKSRC}/COPYING

TEST_DEPENDS=	cmocka>=0:sysutils/cmocka

USES=		cmake:testing cpe pathfix tar:xz
USE_LDCONFIG=	yes

CMAKE_TESTING_ON=	UNIT_TESTING

CMAKE_OFF=	CMAKE_DISABLE_FIND_PACKAGE_Doxygen \
		WITH_DEBUG_CALLTRACE \
		WITH_EXAMPLES \
		WITH_SYMBOL_VERSIONING

CMAKE_ARGS=	-DGLOBAL_BIND_CONFIG=${PREFIX}/etc/ssh/libssh_server_config \
		-DGLOBAL_CLIENT_CONFIG=${PREFIX}/etc/ssh/ssh_config \
		-DCMAKE_CTEST_ARGUMENTS="-E;'torture_config|torture_misc'"

OPTIONS_DEFINE=		GSSAPI STATIC
OPTIONS_RADIO=		CRYPTO
OPTIONS_RADIO_CRYPTO=	MBEDTLS OPENSSL
OPTIONS_DEFAULT=	GSSAPI OPENSSL
OPTIONS_SUB=		yes

CRYPTO_DESC=		Crypto backend

GSSAPI_CMAKE_BOOL=	WITH_GSSAPI

MBEDTLS_LIB_DEPENDS=	libmbedcrypto.so:security/mbedtls
MBEDTLS_CMAKE_BOOL=	WITH_MBEDTLS

OPENSSL_USES=		ssl
OPENSSL_CMAKE_OFF=	-DCMAKE_DISABLE_FIND_PACKAGE_OpenSSL:BOOL=True

STATIC_CMAKE_BOOL=	BUILD_STATIC_LIB

post-install-STATIC-on:
	${INSTALL_DATA} ${INSTALL_WRKSRC}/src/libssh.a ${STAGEDIR}${PREFIX}/lib/

.include <bsd.port.mk>
