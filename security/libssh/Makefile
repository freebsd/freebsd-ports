PORTNAME=	libssh
PORTVERSION=	0.10.6
CATEGORIES=	security devel
MASTER_SITES=	https://www.libssh.org/files/${PORTVERSION:R}/

MAINTAINER=	sunpoet@FreeBSD.org
COMMENT=	Library implementing the SSH2 protocol
WWW=		https://www.libssh.org/

LICENSE=	LGPL21
LICENSE_FILE=	${WRKSRC}/COPYING

USES=		cmake cpe tar:xz

CMAKE_OFF=	CLIENT_TESTING FUZZ_TESTING PICKY_DEVELOPER SERVER_TESTING UNIT_TESTING WITH_ABI_BREAK WITH_BENCHMARKS WITH_BLOWFISH_CIPHER WITH_DEBUG_CALLTRACE WITH_DEBUG_CRYPTO WITH_DEBUG_PACKET WITH_DSA WITH_EXAMPLES WITH_INSECURE_NONE WITH_INTERNAL_DOC WITH_MBEDTLS WITH_NACL WITH_PKCS11_URI
CMAKE_ON=	BUILD_SHARED_LIBS BUILD_STATIC_LIB WITH_GEX WITH_PCAP WITH_SERVER WITH_SFTP WITH_SYMBOL_VERSIONING
USE_LDCONFIG=	yes

OPTIONS_DEFINE=	GSSAPI ZLIB
OPTIONS_RADIO=	CRYPTO
OPTIONS_RADIO_CRYPTO=	GCRYPT OPENSSL
OPTIONS_DEFAULT=GSSAPI OPENSSL ZLIB

GCRYPT_CMAKE_BOOL=	WITH_GCRYPT
GCRYPT_LIB_DEPENDS=	libgcrypt.so:security/libgcrypt \
			libgpg-error.so:security/libgpg-error
GSSAPI_CMAKE_BOOL=	WITH_GSSAPI
OPENSSL_USES=		ssl
ZLIB_CMAKE_BOOL=	WITH_ZLIB

post-patch:
	@${RM} ${WRKSRC}/cmake/Modules/UseDoxygen.cmake

post-install:
	${INSTALL_DATA} ${INSTALL_WRKSRC}/src/libssh.a ${STAGEDIR}${PREFIX}/lib/

.include <bsd.port.mk>
