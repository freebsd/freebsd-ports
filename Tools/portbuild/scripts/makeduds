#!/bin/sh
# usage: $0 branch

# -j# to make duds
DUDSJOBS=4

usage () {
  echo "usage: makeduds branch"
  exit 1
}
if [ $# != 1 ]; then
  usage
fi
case "x$1" in
  x2.2)
    branch=2.2
    export PORTOBJFORMAT=aout
    export OSREL=2.2.8
    export OSVERSION=228001
    ;;
  x3)
    branch=3
    export PORTOBJFORMAT=elf
    export OSREL=3.5
    export OSVERSION=350001
    ;;
  x4)
    branch=4
    export PORTOBJFORMAT=elf
    export OSREL=4.3
    export OSVERSION=430000
    ;;
  x5)
    branch=5
    export PORTOBJFORMAT=elf
    export OSREL=5.0
    export OSVERSION=500017
    ;;
  *)
    usage
    ;;
esac

export PORTSDIR=$(pwd)
duds=../../${branch}/duds

if [ "x$NODUMMY" = "x" ]; then
  unset XFREE86_VERSION
  unset MOTIF_OPEN
else
  export XFREE86_VERSION=4
  export MOTIF_OPEN=t
fi
unset DISPLAY
export BATCH=t
export HAVE_MOTIF=t
export PACKAGE_BUILDING=t
export PARALLEL_PACKAGE_BUILD=t
#export NO_RESTRICTED=t
#export FOR_CDROM=t
make -j${DUDSJOBS} ignorelist ECHO_MSG=true > ${duds} || exit 1
sort ${duds} > ${duds}.tmp
mv -f ${duds}.tmp ${duds}
