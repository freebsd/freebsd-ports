--- ../nas/nas-1.4.1.patch.orig	Thu Nov  1 17:27:31 2001
+++ ../nas/nas-1.4.1.patch	Thu Oct 31 10:17:40 2002
@@ -120,26 +120,157 @@
   	    return(-1);
   	}
   
-*** misc/nas-1.4.1/lib/audio/Imakefile	Sat Jan  1 10:28:13 2000
---- misc/build/nas-1.4.1/lib/audio/Imakefile	Thu Nov  1 13:12:56 2001
-***************
-*** 25,30 ****
---- 25,32 ----
-  
-  #include "../../config/NetAudio.tmpl"
-  
-+ CCOPTIONS += $(EXTRA_CCOPTIONS)
-+ 
-  #if ProjectX < 5
-  /* Pre-X11R5 compatability */
-  #ifndef NormalLibX
-***************
-*** 119,124 ****
---- 121,127 ----
-  
-  #endif
-  BuildIncludes($(HEADERS),audio,..)
-+ BuildIncludes($(HEADERS),audio,$(BUILDINCTOP:../..=.))
-  InstallMultiple($(HEADERS),$(INCDIR))
-  #if ProjectX >= 5
-  InstallNonExecFile(AuErrorDB,$(LIBDIR))
+--- misc/nas-1.4.1/Imakefile.orig	Wed Mar  6 02:20:01 2002
++++ misc/build/nas-1.4.1/Imakefile	Wed Mar  6 02:20:07 2002
+@@ -42,6 +42,8 @@
+ 	@echo ""
+ 	Date
+ 	@echo ""
++	@find . | egrep "\.(cxx|h|c)$$" | xargs \
++                ${PERL} -pi -e "s|<malloc.h>|<stdlib.h>|g"
+ 	$(MAKE) $(MFLAGS) Makefiles
+ 	$(MAKE) $(MFLAGS) clean
+ 	$(MAKE) $(MFLAGS) includes
+--- misc/nas-1.4.1/clients/audio/audial/audial.c.orig	Wed Nov  5 18:50:21 1997
++++ misc/build/nas-1.4.1/clients/audio/audial/audial.c	Wed Nov  5 18:56:33 1997
+@@ -133,6 +133,7 @@
+     signal(SIGALRM, SIG_DFL);
+ }
+ 
++#if !defined(__FreeBSD__) || (__FreeBSD__ < 3)
+ static void
+ usleep(usecs)
+ unsigned int    usecs;
+@@ -149,7 +150,7 @@
+     setitimer(ITIMER_REAL, &ntval, &otval);
+     pause();
+ }
+-
++#endif
+ #endif						/* SYSV else not */
+ #endif						/* VMS else not */
+ #endif						/* NEEDUSLEEP */
+--- misc/nas-1.4.1/server/dda/voxware/auvoxware.c.orig	Sun Mar  5 03:40:55 2000
++++ misc/build/nas-1.4.1/server/dda/voxware/auvoxware.c	Sat Dec 16 22:11:35 2000
+@@ -155,8 +155,10 @@
+ #include <assert.h>
+ 
+ #ifdef __FreeBSD__
+-# include <machine/soundcard.h>
+-# include <machine/pcaudioio.h>
++# include <sys/soundcard.h>
++# ifdef __i386__
++#  include <machine/pcaudioio.h>
++# endif
+ #else
+ # ifdef __NetBSD__
+ #  include <sys/ioctl.h>
+@@ -610,7 +612,11 @@
+ 
+     if(sndStatOut.fd == -1)
+     {
++#ifdef __FreeBSD__
++       while ((sndStatOut.fd = open(sndStatOut.device, O_RDWR)) == -1 && wait)
++#else
+        while ((sndStatOut.fd = open(sndStatOut.device, O_RDWR|O_SYNC)) == -1 && wait)
++#endif
+        {
+            osLogMsg("openDevice: waiting on output device\n");
+            sleep(1);
+@@ -1230,6 +1236,11 @@
+ /*
+  * Setup soundcard at maximum audio quality.
+  */
++
++#ifdef __FreeBSD__
++#define NO_16_BIT_SAMPLING
++#endif
++
+ static void setupSoundcard(sndStatPtr)
+ SndStat* sndStatPtr;
+ {
+@@ -1380,7 +1391,11 @@
+ 
+     AL_initialized = AuTrue;
+ 
++#ifdef __FreeBSD__
++    if ((fd = open(sndStatOut.device, O_RDWR, 0)) == -1) {
++#else
+     if ((fd = open(sndStatOut.device, O_RDWR|O_SYNC, 0)) == -1) {
++#endif
+         UNIDENTMSG;
+         return AuFalse;
+     }
+--- misc/nas-1.4.1/clients/audio/auedit/Graph.c.orig	Mon Oct 25 02:24:08 1999
++++ misc/build/nas-1.4.1/clients/audio/auedit/Graph.c	Sat Mar 25 14:56:23 2000
+@@ -28,7 +28,7 @@
+  */
+ 
+ #ifndef WIN32
+-# ifdef __NetBSD__
++# if defined(__NetBSD__) || defined(__FreeBSD__)
+ #  include <limits.h>
+ #  define MAXSHORT SHRT_MAX
+ #  define MINSHORT SHRT_MIN
+--- misc/nas-1.4.1/lib/audio/Imakefile.orig	Sun May 19 14:52:20 2002
++++ misc/build/nas-1.4.1/lib/audio/Imakefile	Sun May 19 14:54:25 2002
+@@ -25,6 +25,8 @@
+ 
+ #include "../../config/NetAudio.tmpl"
+ 
++CCOPTIONS += $(EXTRA_CCOPTIONS)
++
+ #if ProjectX < 5
+ /* Pre-X11R5 compatability */
+ #ifndef NormalLibX
+@@ -64,10 +66,14 @@
+     COMPAT_OBJS = AuGetBest.o
+ #endif /* ProjectX < 5 */
+ 
++#if HasBSD44Sockets
++    SOCK_DEFINES = -DBSD44SOCKETS
++#endif
++
+      EDB_DEFINES = -DERRORDB=\"$(LIBDIR)/AuErrorDB\"
+ 
+         DEFINES = $(MALLOC_DEFINES) $(SYSV_DEFINES)
+-   CONN_DEFINES = ConnectionFlags
++   CONN_DEFINES = ConnectionFlags $(SOCK_DEFINES)
+ 
+ HEADERS = Alibint.h Alibnet.h Xtutil.h audiolib.h audioutil.h snd.h wave.h    \
+           voc.h aiff.h sound.h soundlib.h fileutil.h 8svx.h Astreams.h \
+@@ -119,6 +125,7 @@
+ 
+ #endif
+ BuildIncludes($(HEADERS),audio,..)
++BuildIncludes($(HEADERS),audio,$(BUILDINCTOP:../..=.))
+ InstallMultiple($(HEADERS),$(INCDIR))
+ #if ProjectX >= 5
+ InstallNonExecFile(AuErrorDB,$(LIBDIR))
+--- misc/nas-1.4.1/config/NetAudio.def.orig	Sun Feb 13 05:31:14 2000
++++ misc/build/nas-1.4.1/config/NetAudio.def	Fri Mar 24 04:55:49 2000
+@@ -8,5 +8,5 @@
+ 
+ XCOMM Directory where NAS will look for it's config file(s)
+ #ifndef NasConfigSearchPath
+-#define NasConfigSearchPath /etc/nas/
++#define NasConfigSearchPath $(PROJECTROOT)/etc/
+ #endif
+--- misc/nas-1.4.1/server/dia/gram.y.orig	Thu Oct 31 10:13:28 2002
++++ misc/build/nas-1.4.1/server/dia/gram.y	Thu Oct 31 10:15:18 2002
+@@ -120,13 +120,13 @@
+ 		| MAXRATE number
+ 			{ ddaSetConfig(MAXRATE, (void *)$2); }
+ 		| MINRATE number
+-			{ ddaSetConfig(MINRATE, (void *)$2); }
++			{ ddaSetConfig(MINRATE, (void *)$2); };
+ 
+ string		: STRING		{ ptr = (char *)malloc(strlen($1)+1);
+ 					  strcpy(ptr, $1);
+ 					  RemoveDQuote(ptr);
+ 					  $$ = ptr;
+-					}
++					};
+ number		: NUMBER		{ $$ = $1; }
+ 		;
+ 
