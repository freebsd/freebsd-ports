# $FreeBSD$

PORTNAME=	sdl2
PORTVERSION=	2.0.1
PORTREVISION=	1
CATEGORIES=	devel
MASTER_SITES=	http://www.libsdl.org/release/
DISTNAME=	SDL2-${PORTVERSION}

MAINTAINER=	mva@FreeBSD.org
COMMENT=	Cross-platform multimedia development API

LICENSE=	ZLIB

USES=		pathfix cmake:outsource iconv
USE_LDCONFIG=	yes

CMAKE_ARGS+=	-DVIDEO_OPENGLES:BOOL=OFF -DALTIVEC:BOOL=OFF -DARTS:BOOL=OFF
CMAKE_ENV+=	CFLAGS="-I${LOCALBASE}/include" LDFLAGS="-L${LOCALBASE}/lib"

OPTIONS_DEFINE=		ALSA ASM DLOPEN ESOUND MMX NAS OSS \
			PULSEAUDIO PTHREADS SSE SDL_ATOMIC SDL_AUDIO \
			SDL_CPUINFO SDL_EVENTS SDL_FILE SDL_HAPTIC \
			SDL_JOYSTICK SDL_LOADSO SDL_POWER SDL_RENDER \
			SDL_THREADS SDL_TIMERS SDL_VIDEO VIDEO_OPENGL VIDEO_X11
OPTIONS_DEFAULT=	ASM DLOPEN OSS PTHREADS SDL_ATOMIC SDL_AUDIO \
			SDL_CPUINFO SDL_EVENTS SDL_FILE SDL_HAPTIC \
			SDL_JOYSTICK SDL_LOADSO SDL_POWER SDL_RENDER \
			SDL_THREADS SDL_TIMERS SDL_VIDEO VIDEO_OPENGL VIDEO_X11
OPTIONS_DEFAULT_i386=	MMX SSE
OPTIONS_DEFAULT_amd64=	MMX SSE

ALSA_DESC=		Audio output via the ALSA audio architecture
DLOPEN_DESC=		Use dlopen for loading 3rd party libraries
ESOUND_DESC=		Audio output via the EsounD sound server
NAS_DESC=		Audio output via the Network Audio System
OSS_DESC=		Audio output via the Open Sound System
PULSEAUDIO_DESC=	Audio output via the PulseAudio sound server
PTHREADS_DESC=		Use POSIX threads for multi-threading
SDL_ATOMIC_DESC=	Enable the SDL Atomic subsystem
SDL_AUDIO_DESC=		Enable the SDL Audio subsystem
SDL_CPUINFO_DESC=	Enable the SDL CPUinfo subsystem
SDL_EVENTS_DESC=	Enable the SDL Events subsystem
SDL_FILE_DESC=		Enable the SDL File subsystem
SDL_HAPTIC_DESC=	Enable the SDL Haptic subsystem
SDL_JOYSTICK_DESC=	Enable the SDL Joystick subsystem
SDL_LOADSO_DESC=	Enable the SDL Loadso subsystem
SDL_POWER_DESC=		Enable the SDL Power subsystem
SDL_RENDER_DESC=	Enable the SDL Render subsystem
SDL_THREADS_DESC=	Enable the SDL Threads subsystem
SDL_TIMERS_DESC=	Enable the SDL Timers subsystem
SDL_VIDEO_DESC=		Eanble the SDL Video subsystem
VIDEO_OPENGL_DESC=	OpenGL rendering support
VIDEO_X11_DESC=		X11 rendering support

.include <bsd.port.options.mk>

.if ${PORT_OPTIONS:MALSA}
.if !${PORT_OPTIONS:MSDL_AUDIO}
IGNORE=	option ALSA requires SDL_AUDIO
.endif
CMAKE_ARGS+=	-DALSA:BOOL=ON -DALSA_SHARED:BOOL=ON
LIB_DEPENDS+=	libasound.so:${PORTSDIR}/audio/alsa-lib
.else
CMAKE_ARGS+=	-DALSA:BOOL=OFF
.endif

CMAKE_ARGS+=	-DARTS:BOOL=OFF

.if ${PORT_OPTIONS:MASM}
CMAKE_ARGS+=	-DASSEMBLY:BOOL=ON
.else
CMAKE_ARGS+=	-DASSEMBLY:BOOL=OFF
.endif

.if ${PORT_OPTIONS:MDLOPEN}
CMAKE_ARGS+=	-DSDL_DLOPEN:BOOL=ON
.else
CMAKE_ARGS+=	-DSDL_DLOPEN:BOOL=OFF
.endif

.if ${PORT_OPTIONS:MESOUND}
.if !${PORT_OPTIONS:MSDL_AUDIO}
IGNORE=	option ESOUND requires SDL_AUDIO
.endif
CMAKE_ARGS+=	-DESD:BOOL=ON -DESD_SHARED:BOOL=ON
USE_GNOME+=	esound
.else
CMAKE_ARGS+=	-DESD:BOOL=OFF
.endif

.if ${PORT_OPTIONS:MMMX}
CMAKE_ARGS+=	-DMMX:BOOL=ON -D3DNOW:BOOL=ON
.else
CMAKE_ARGS+=	-DMMX:BOOL=OFF -D3DNOW:BOOL=OFF
.endif

.if ${PORT_OPTIONS:MNAS}
.if !${PORT_OPTIONS:MSDL_AUDIO}
IGNORE=	option NAS requires SDL_AUDIO
.endif
CMAKE_ARGS+=	-DNAS:BOOL=ON
LIB_DEPENDS+=	libaudio.so:${PORTSDIR}/audio/nas
.else
CMAKE_ARGS+=	-DNAS:BOOL=OFF
.endif

.if ${PORT_OPTIONS:MOSS}
.if !${PORT_OPTIONS:MSDL_AUDIO}
IGNORE=	option OSS requires SDL_AUDIO
.endif
CMAKE_ARGS+=	-DOSS:BOOL=ON
.else
CMAKE_ARGS+=	-DOSS:BOOL=OFF
.endif

.if ${PORT_OPTIONS:MPULSEAUDIO}
.if !${PORT_OPTIONS:MSDL_AUDIO}
IGNORE=	option PULSEAUDIO requires SDL_AUDIO
.endif
CMAKE_ARGS+=	-DPULSEAUDIO:BOOL=ON -DPULSEAUDIO_SHARED:BOOL=ON
.else
CMAKE_ARGS+=	-DPULSEAUDIO:BOOL=OFF
.endif

.if ${PORT_OPTIONS:MPTHREADS}
CMAKE_ARGS+=	-DPTHREADS:BOOL=ON
.else
CMAKE_ARGS+=	-DPTHREADS:BOOL=OFF
.endif

.if ${PORT_OPTIONS:MSDL_ATOMIC}
CMAKE_ARGS+=	-DSDL_ATOMIC:BOOL=ON
.else
CMAKE_ARGS+=	-DSDL_ATOMIC:BOOL=OFF
.endif

.if ${PORT_OPTIONS:MSDL_AUDIO}
CMAKE_ARGS+=	-DSDL_AUDIO:BOOL=ON
.else
CMAKE_ARGS+=	-DSDL_AUDIO:BOOL=OFF
.endif

.if ${PORT_OPTIONS:MSDL_CPUINFO}
CMAKE_ARGS+=	-DSDL_CPUINFO:BOOL=ON
.else
CMAKE_ARGS+=	-DSDL_CPUINFO:BOOL=OFF
.endif

.if ${PORT_OPTIONS:MSDL_EVENTS}
CMAKE_ARGS+=	-DSDL_EVENTS:BOOL=ON
.else
CMAKE_ARGS+=	-DSDL_EVENTS:BOOL=OFF
.endif

.if ${PORT_OPTIONS:MSDL_FILE}
CMAKE_ARGS+=	-DSDL_FILE:BOOL=ON
.else
CMAKE_ARGS+=	-DSDL_FILE:BOOL=OFF
.endif

.if ${PORT_OPTIONS:MSDL_HAPTIC}
CMAKE_ARGS+=	-DSDL_HAPTIC:BOOL=ON
.else
CMAKE_ARGS+=	-DSDL_HAPTIC:BOOL=OFF
.endif

.if ${PORT_OPTIONS:MSDL_JOYSTICK}
CMAKE_ARGS+=	-DSDL_JOYSTICK:BOOL=ON
.else
CMAKE_ARGS+=	-DSDL_JOYSTICK:BOOL=OFF
.endif

.if ${PORT_OPTIONS:MSDL_LOADSO}
CMAKE_ARGS+=	-DSDL_LOADSO:BOOL=ON
.else
CMAKE_ARGS+=	-DSDL_LOADSO:BOOL=OFF
.endif

.if ${PORT_OPTIONS:MSDL_POWER}
CMAKE_ARGS+=	-DSDL_POWER:BOOL=ON
.else
CMAKE_ARGS+=	-DSDL_POWER:BOOL=OFF
.endif

.if ${PORT_OPTIONS:MSDL_RENDER}
CMAKE_ARGS+=	-DSDL_RENDER:BOOL=ON
.else
CMAKE_ARGS+=	-DSDL_RENDER:BOOL=OFF
.endif

.if ${PORT_OPTIONS:MSDL_THREADS}
CMAKE_ARGS+=	-DSDL_THREADS:BOOL=ON
.else
CMAKE_ARGS+=	-DSDL_THREADS:BOOL=OFF
.endif

.if ${PORT_OPTIONS:MSDL_TIMERS}
CMAKE_ARGS+=	-DSDL_TIMERS:BOOL=ON
.else
CMAKE_ARGS+=	-DSDL_TIMERS:BOOL=OFF
.endif

.if ${PORT_OPTIONS:MSDL_VIDEO}
CMAKE_ARGS+=	-DSDL_VIDEO:BOOL=ON
.else
CMAKE_ARGS+=	-DSDL_VIDEO:BOOL=OFF
.endif

.if ${PORT_OPTIONS:MSSE}
CMAKE_ARGS+=	-DSSE:BOOL=ON -DSSE2:BOOL=ON -DSSEMATH:BOOL=ON
.else
CMAKE_ARGS+=	-DSSE:BOOL=OFF -DSSE2:BOOL=OFF -DSSEMATH:BOOL=OFF
.endif

.if ${PORT_OPTIONS:MVIDEO_OPENGL}
.if !${PORT_OPTIONS:MSDL_VIDEO}
IGNORE=	option VIDEO_OPENGL requires SDL_VIDEO
.endif
CMAKE_ARGS+=	-DVIDEO_OPENGL:BOOL=ON
USE_GL=		gl
.else
CMAKE_ARGS+=	-DVIDEO_OPENGL:BOOL=OFF
.endif

.if ${PORT_OPTIONS:MVIDEO_X11}
.if !${PORT_OPTIONS:MSDL_VIDEO}
IGNORE=	option VIDEO_X11 requires SDL_VIDEO
.endif
CMAKE_ARGS+=	-DVIDEO_X11:BOOL=ON -DVIDEO_X11_XCURSOR:BOOL=ON \
		-DVIDEO_X11_XINERAMA:BOOL=ON -DVIDEO_X11_XINPUT:BOOL=ON \
		-DVIDEO_X11_XRANDR:BOOL=ON -DVIDEO_X11_XSCRNSAVER:BOOL=ON \
		-DVIDEO_X11_XSHAPE:BOOL=ON -DVIDEO_X11_XVM:BOOL=ON \
		-DX11_SHARED:BOOL=ON
USE_XORG+=	xinerama xcursor xi xrandr xscrnsaver xxf86vm xext
.else
CMAKE_ARGS+=	-DVIDEO_X11:BOOL=OFF -DVIDEO_X11_XCURSOR:BOOL=OFF \
		-DVIDEO_X11_XINERAMA:BOOL=OFF -DVIDEO_X11_XINPUT:BOOL=OFF \
		-DVIDEO_X11_XRANDR:BOOL=OFF -DVIDEO_X11_XSCRNSAVER:BOOL=OFF \
		-DVIDEO_X11_XSHAPE:BOOL=OFF -DVIDEO_X11_XVM:BOOL=OFF \
		-DX11_SHARED:BOOL=OFF
.endif

.include <bsd.port.mk>
