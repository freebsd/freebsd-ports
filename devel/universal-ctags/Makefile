# Created by: Derek Schrock <dereks@lifeofadishwasher.com>
# $FreeBSD$

PORTNAME=	universal-ctags
PORTVERSION=	g20190717
CATEGORIES=	devel

MAINTAINER=	dereks@lifeofadishwasher.com
COMMENT=	Fork of Exuberant Ctags to generate index/tag files

LICENSE=	GPLv2
LICENSE_FILE=	${WRKSRC}/COPYING

USES=		autoreconf pkgconfig

GNU_CONFIGURE=	yes

USE_GITHUB=	yes
GH_PROJECT=	ctags
GH_TAGNAME=	ff180005

OPTIONS_DEFINE=			ASPELL DEBUG ICONV JSON LIBXML2 MANPAGES YAML
OPTIONS_DEFAULT=		ICONV JSON LIBXML2 MANPAGES YAML

CONFIGURE_ARGS=	--program-prefix=u

JSON_DESC=			JSON output support

ASPELL_CONFIGURE_ENABLE=	aspell
# textproc/aspell does not install a aspell.pc file
ASPELL_CONFIGURE_ENV=		ASPELL_LIBS="-L${LOCALBASE}/lib -laspell" \
				ASPELL_CFLAGS="-I${LOCALBASE}/include"
ASPELL_LIB_DEPENDS=		libaspell.so:textproc/aspell
ASPELL_VARS=	TEST_DEPENDS+=${LOCALBASE}/share/aspell/en_US.multi:textproc/en-aspell

DEBUG_CONFIGURE_ENABLE=		debugging

ICONV_CONFIGURE_ENABLE=		iconv
ICONV_USES=			iconv

TEST_TARGET=	check

# Extra support for YAML and XML based languages
LIBXML2_CONFIGURE_ENABLE=	xml
LIBXML2_LIB_DEPENDS=		libxml2.so:textproc/libxml2

JSON_CONFIGURE_ENABLE=		json
JSON_LIB_DEPENDS=		libjansson.so:devel/jansson

MANPAGES_BUILD_DEPENDS=		rst2man:textproc/py-docutils
MANPAGES_PLIST_FILES=		man/man1/uctags.1.gz \
				man/man7/uctags-incompatibilities.7.gz \
				man/man7/uctags-optlib.7.gz

YAML_CONFIGURE_ENABLE=		yaml
YAML_LIB_DEPENDS=		libyaml.so:textproc/libyaml

PLIST_FILES=			bin/uctags \
				bin/ureadtags

pre-configure:
	# test-case.mak is generated by autogen.sh disable it for building
	@${REINPLACE_CMD} -e '/^m4_include(\[Tmain\/dist.m4])$$/s/^/#/' ${WRKSRC}/configure.ac
	@${REINPLACE_CMD} -e '/^m4_include(\[Units\/dist.m4])$$/s/^/#/' ${WRKSRC}/configure.ac

.include <bsd.port.mk>
