--- generic/crypt.c	Sat Nov 18 17:42:31 2000
+++ generic/crypt.c	Fri Feb  8 11:59:47 2002
@@ -29,4 +29,6 @@
 
+#include <sys/types.h>
+#include <unistd.h>
 #include "loadman.h"
 
 static int
@@ -112,4 +112,6 @@
  */
 
+char *crypt_md5(const char *pw, const char *salt); /* Lives in -lcrypt */
+
 static int
 TrfMd5CryptObjCmd (notUsed, interp, objc, objv)
@@ -128,8 +130,4 @@
   Tcl_Obj*    res;
 
-  if (TrfLoadMD5 (interp) != TCL_OK) {
-    return TCL_ERROR;
-  }
-
   if (objc != 3) {
     Tcl_AppendResult (interp,
@@ -159,5 +157,5 @@
 
   TrfLock;
-  res = Tcl_NewStringObj ((char*) md5f.crypt (passwd, salt_b) + 3, -1);
+  res = Tcl_NewStringObj (crypt_md5(passwd, salt_b) + 3, -1);
   TrfUnlock;
 
