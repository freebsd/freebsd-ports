# Created by: Ed Schouten <ed@FreeBSD.org>
# $FreeBSD$

PORTNAME=	arpc
DISTVERSIONPREFIX=	v
DISTVERSION=	0.6
CATEGORIES=	devel

MAINTAINER=	ed@FreeBSD.org
COMMENT=	GRPC-like RPC library that supports file descriptor passing

LICENSE=	BSD2CLAUSE
LICENSE_FILE=	${WRKSRC}/LICENSE

BUILD_DEPENDS=	${PYTHON_PKGNAMEPREFIX}pyPEG2>=2.15.2:textproc/py3-pyPEG2 \
		${PYTHON_PKGNAMEPREFIX}toposort>=1.5:devel/py3-toposort
LIB_DEPENDS=	libargdata.so:devel/argdata
RUN_DEPENDS=	${PYTHON_PKGNAMEPREFIX}pyPEG2>=2.15.2:textproc/py3-pyPEG2 \
		${PYTHON_PKGNAMEPREFIX}toposort>=1.5:devel/py3-toposort

USES=		cmake localbase:ldflags python:3 tar:xz
USE_LDCONFIG=	yes
USE_GITHUB=	yes
GH_ACCOUNT=	NuxiNL

PLIST_FILES=	bin/aprotoc include/arpc++/arpc++.h \
		lib/libarpc.so lib/libarpc.so.1

.include <bsd.port.pre.mk>

.if ${OPSYS} == FreeBSD && ${OSVERSION} < 1100511
IGNORE=		requires various C++17 features
.endif

# Require the unit tests to pass prior to installing.
post-build:
	@trap '' PIPE && ${WRKSRC}/arpc_tests

.include <bsd.port.post.mk>
