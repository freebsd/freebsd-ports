--- ltconfig.orig	Fri Dec 13 23:36:10 2002
+++ ltconfig	Fri Dec 13 23:47:30 2002
@@ -169,7 +169,7 @@
 # Constants:
 PROGRAM=ltconfig
 PACKAGE=libtool
-VERSION=1.3.5
+VERSION=1.3.5-freebsd-ports
 TIMESTAMP=" (1.385.2.206 2000/05/27 11:12:27)"
 ac_compile='${CC-cc} -c $CFLAGS $CPPFLAGS conftest.$ac_ext 1>&5'
 ac_link='${CC-cc} -o conftest $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS 1>&5'
@@ -185,6 +185,8 @@
 # which needs '.lib').
 enable_static=yes
 enable_fast_install=yes
+install_ltlibs=yes
+release_suffix=yes
 enable_dlopen=unknown
 enable_win32_dll=no
 ltmain=
@@ -242,10 +244,14 @@
 
 Generate a system-specific libtool script.
 
+    --build                no-op to keep compatability with configure scripts generated for 1.4
     --debug                enable verbose shell tracing
     --disable-shared       do not build shared libraries
     --disable-static       do not build static libraries
     --disable-fast-install do not optimize for fast installation
+    --disable-ltlibs       don't install the .la archives
+    --release-ignore       don't use -release specification
+    --release-suffix       use -release suffix for all files
     --enable-dlopen        enable dlopen support
     --enable-win32-dll     enable building dlls on win32 hosts
     --help                 display this help and exit
@@ -268,6 +274,8 @@
   exit 0
   ;;
 
+  --build=*) ;;
+
   --debug)
     echo "$progname: enabling shell trace mode"
     set -x
@@ -279,6 +287,12 @@
 
   --disable-fast-install) enable_fast_install=no ;;
 
+  --disable-ltlibs) install_ltlibs=no ;;
+
+  --release-ignore) release_suffix=no ;;
+
+  --release-suffix) release_suffix=all ;;
+
   --enable-dlopen) enable_dlopen=yes ;;
 
   --enable-win32-dll) enable_win32_dll=yes ;;
@@ -971,11 +985,11 @@
   $rm conftest.dat
   if ln -s X conftest.dat 2>/dev/null; then
     $rm conftest.dat
-    LN_S="ln -s"
+    LN_S="ln -sf"
   else
     LN_S=ln
   fi
-  if test "$LN_S" = "ln -s"; then
+  if test "$LN_S" = "ln -sf"; then
     echo "$ac_t"yes 1>&6
   else
     echo "$ac_t"no 1>&6
@@ -1232,8 +1246,8 @@
 
   *)
     if $LD --help 2>&1 | egrep ': supported targets:.* elf' > /dev/null; then
-      archive_cmds='$CC -shared $libobjs $deplibs $linkopts ${wl}-soname $wl$soname -o $lib'
-      archive_expsym_cmds='$CC -shared $libobjs $deplibs $linkopts ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+      archive_cmds='$CC -shared $compile_rpath $libobjs $deplibs $linkopts ${wl}-soname $wl$soname -o $lib'
+      archive_expsym_cmds='$CC -shared $compile_rpath $libobjs $deplibs $linkopts ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
     else
       ld_shlibs=no
     fi
@@ -1359,14 +1373,6 @@
     hardcode_shlibpath_var=no
     ;;
 
-  # FreeBSD 3 and greater uses gcc -shared to do shared libraries.
-  freebsd*)
-    archive_cmds='$CC -shared -o $lib $libobjs $deplibs $linkopts'
-    hardcode_libdir_flag_spec='-R$libdir'
-    hardcode_direct=yes
-    hardcode_shlibpath_var=no
-    ;;
-
   hpux9* | hpux10* | hpux11*)
     case "$host_os" in
     hpux9*) archive_cmds='$rm $objdir/$soname~$LD -b +b $install_libdir -o $objdir/$soname $libobjs $deplibs $linkopts~test $objdir/$soname = $lib || mv $objdir/$soname $lib' ;;
@@ -1793,7 +1799,7 @@
 version_type=none
 dynamic_linker="$host_os ld.so"
 sys_lib_dlsearch_path_spec="/lib /usr/lib"
-sys_lib_search_path_spec="/lib /usr/lib /usr/local/lib"
+sys_lib_search_path_spec="/lib /usr/lib"
 file_magic_cmd=
 file_magic_test_file=
 deplibs_check_method='unknown'
@@ -1891,19 +1897,22 @@
   version_type=freebsd-$objformat
   case "$version_type" in
     freebsd-elf*)
-      deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [LM]SB shared object'
-      file_magic_cmd=/usr/bin/file
-      file_magic_test_file=`echo /usr/lib/libc.so*`
-      library_names_spec='${libname}${release}.so$versuffix ${libname}${release}.so $libname.so'
-      need_version=no
-      need_lib_prefix=no
+      deplibs_check_method='file_magic (ELF [0-9][0-9]*-bit [LM]SB shared object|current ar archive)'
       ;;
     freebsd-*)
-      deplibs_check_method=unknown
-      library_names_spec='${libname}${release}.so$versuffix $libname.so$versuffix'
-      need_version=yes
+      deplibs_check_method='file_magic FreeBSD.* shared library'
       ;;
   esac
+  file_magic_cmd=/usr/bin/file
+  file_magic_test_file=`echo /usr/lib/libc.so*`
+  if test "$release_suffix" = all; then
+    library_names_spec='${libname}${release}.so$versuffix ${libname}${release}.so'
+  else
+    library_names_spec='${libname}${release}.so$versuffix ${libname}.so'
+  fi 
+  need_version=no
+  need_lib_prefix=no
+  finish_cmds='/usr/bin/env OBJFORMAT="'"$objformat"'" /sbin/ldconfig -m $libdir'
   shlibpath_var=LD_LIBRARY_PATH
   case "$host_os" in
   freebsd2* | freebsd3.[01]* | freebsdelf3.[01]*)
@@ -2812,6 +2821,15 @@
 
 # Shell to use when invoking shell scripts.
 SHELL=$LTSHELL
+
+# Whether to waste disk space.
+install_ltlibs=$install_ltlibs 
+
+# What to do with -release.
+#  yes - only for shared archive
+#  no  - ingnore
+#  all - for all archives
+release_suffix=$release_suffix
 
 # Whether or not to build shared libraries.
 build_libtool_libs=$enable_shared
