#!/bin/sh
#
# $FreeBSD$
#
# unbound freebsd startup rc.d script, modified from the named script.
# uses the default unbound installation path and pidfile location.
# copy this to /etc/rc.d/unbound
# and put unbound_enable="YES" into rc.conf
#

# PROVIDE: unbound
# REQUIRE: SERVERS cleanvar
# KEYWORD: shutdown

. /etc/rc.subr

name="unbound"
rcvar=unbound_enable

command="%%PREFIX%%/sbin/unbound"
extra_commands="reload"
start_precmd="start_precmd"
reload_precmd="%%PREFIX%%/sbin/unbound-checkconf >/dev/null" 

load_rc_config $name

pidfile=${unbound_pidfile:-"%%PREFIX%%/etc/unbound/unbound.pid"}
unbound_enable=${unbound_enable:-"NO"}
unbound_anchor_enable=${unbound_anchor_enable:-"YES"}
unbound_anchor_flags=${unbound_anchor_flags:-""}

start_precmd()
{
	%%PREFIX%%/sbin/unbound-checkconf || return 1
    if checkyesno ${unbound_anchor_enable}; then
        echo -n "Obtaining a trust anchor:"
        su -m unbound -c %%PREFIX%%/sbin/unbound-anchor ${unbound_anchor_flags} || return 1
    fi
	echo .
}

run_rc_command "$1"
