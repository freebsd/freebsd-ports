*** makefile.orig	Fri Jan 26 10:38:44 1996
--- makefile	Tue Feb 20 00:55:17 1996
***************
*** 2,27 ****
  # Copyright (C) 1995 Guy Eric Schalnat, Group 42, Inc.
  # For conditions of distribution and use, see copyright notice in png.h
  
! CC=cc
! CFLAGS=-I../zlib -O
! LDFLAGS=-L. -L../zlib/ -lpng -lz -lm
  
  #RANLIB=ranlib
! RANLIB=echo
  
  # where make install puts libpng.a and png.h
! prefix=/usr/local
  
  OBJS = png.o pngrcb.o pngrutil.o pngtrans.o pngwutil.o \
  	pngread.o pngio.o pngwrite.o pngrtran.o pngwtran.o \
     pngmem.o pngerror.o pngpread.o
  
! all: libpng.a pngtest
  
  libpng.a: $(OBJS)
  	ar rc $@  $(OBJS)
  	$(RANLIB) $@
  
  pngtest: pngtest.o libpng.a
  	$(CC) -o pngtest $(CCFLAGS) pngtest.o $(LDFLAGS)
  
--- 2,36 ----
  # Copyright (C) 1995 Guy Eric Schalnat, Group 42, Inc.
  # For conditions of distribution and use, see copyright notice in png.h
  
! VER=0.88
! #CC=cc
! CFLAGS+=-I/usr/local/include
! LDFLAGS=-L. -L/usr/local/lib -lpng -lz -lm -static
  
  #RANLIB=ranlib
! #RANLIB=echo
  
  # where make install puts libpng.a and png.h
! prefix=${PREFIX}
  
  OBJS = png.o pngrcb.o pngrutil.o pngtrans.o pngwutil.o \
  	pngread.o pngio.o pngwrite.o pngrtran.o pngwtran.o \
     pngmem.o pngerror.o pngpread.o
  
! .SUFFIXES: .c .so .o
  
+ .c.so:
+ 	${CC} -fpic -DPIC ${CFLAGS} -c ${.IMPSRC} -o ${.TARGET}
+ 
+ all: libpng.a libpng.so.${VER}
+   
  libpng.a: $(OBJS)
  	ar rc $@  $(OBJS)
  	$(RANLIB) $@
  
+ libpng.so.${VER}: $(OBJS:S/o$/so/g)
+ 	ld -Bshareable -o $@ $(OBJS:S/o$/so/g)
+ 
  pngtest: pngtest.o libpng.a
  	$(CC) -o pngtest $(CCFLAGS) pngtest.o $(LDFLAGS)
  
***************
*** 31,42 ****
  install: libpng.a
  	-@mkdir $(prefix)/include
  	-@mkdir $(prefix)/lib
! 	cp png.h $(prefix)/include
! 	cp pngconf.h $(prefix)/include
! 	chmod 644 $(prefix)/include/png.h
! 	chmod 644 $(prefix)/include/pngconf.h
! 	cp libpng.a $(prefix)/lib
! 	chmod 644 $(prefix)/lib/libpng.a
  
  clean:
  	rm -f *.o libpng.a pngtest pngout.png
--- 40,48 ----
  install: libpng.a
  	-@mkdir $(prefix)/include
  	-@mkdir $(prefix)/lib
! 	${INSTALL} -c -m 644 -o ${BINOWN} -g ${BINGRP} png.h pngconf.h $(prefix)/include
! 	${INSTALL} -c -m 644 -o ${BINOWN} -g ${BINGRP} libpng.a libpng.so.${VER} $(prefix)/lib
! 	ranlib $(prefix)/lib/libpng.a
  
  clean:
  	rm -f *.o libpng.a pngtest pngout.png
