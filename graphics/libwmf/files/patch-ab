--- xgd-1.7.3/Makefile.in.orig	Tue Nov 14 19:32:11 2000
+++ xgd-1.7.3/Makefile.in	Mon Dec 18 22:29:49 2000
@@ -36,7 +36,7 @@
 
 #If you don't have FreeType and/or Xpm fully installed, uncomment this
 #(default).
-LIBS= -lxgd @PNG_LIBS@ @ZLIB_LIBS@ @TTF_LIBS@ @XPM_LIBS@ @X_LIBS@ @X11@ @X_EXTRA_LIBS@ -lm
+LIBS=@LIBS@ -lxgd @PNG_LIBS@ @ZLIB_LIBS@ @TTF_LIBS@ @XPM_LIBS@ @X_LIBS@ @X11@ @X_EXTRA_LIBS@ -lm
 
 #If you do have FreeType and/or Xpm fully installed, uncomment a 
 #variation of this and comment out the line above. Note that
@@ -59,7 +59,7 @@
 INSTALL_LIB=@libdir@
 
 #Location where .h files should be installed by "make install".
-INSTALL_INCLUDE=@includedir@
+INSTALL_INCLUDE=@includedir@/xgd
 
 #Location where useful non-test programs should be installed by "make install".
 INSTALL_BIN=@bindir@
@@ -80,18 +80,18 @@
 BIN_PROGRAMS=pngtogd pngtogd2 gdtopng gd2topng gd2copypal gdparttopng webpng
 TEST_PROGRAMS=gdtest gddemo gd2time gdtestttf
 
-all: libxgd.a $(PROGRAMS)
+.SUFFIXES: .c .so .o
 
-install: libxgd.a $(BIN_PROGRAMS)
-	$(INSTALL) libxgd.a $(INSTALL_LIB)/libxgd.a
-	$(INSTALL) pngtogd $(INSTALL_BIN)/pngtogd
-	$(INSTALL) pngtogd2 $(INSTALL_BIN)/pngtogd2
-	$(INSTALL) gdtopng $(INSTALL_BIN)/gdtopng
-	$(INSTALL) gd2topng $(INSTALL_BIN)/gd2topng
-	$(INSTALL) gd2copypal $(INSTALL_BIN)/gd2copypal
-	$(INSTALL) gdparttopng $(INSTALL_BIN)/gdparttopng
-	$(INSTALL) webpng $(INSTALL_BIN)/webpng
-	$(INSTALL) bdftogd $(INSTALL_BIN)/bdftogd
+.c.so:
+	$(CC) $(CFLAGS) -fPIC -DPIC -o $@ -c $<
+
+all: libxgd.a libxgd.so.1
+
+install: libxgd.a libxgd.so.1
+	$(INSTALL_DATA) libxgd.a $(INSTALL_LIB)/libxgd.a
+	$(INSTALL_DATA) libxgd.so.1 $(INSTALL_LIB)/libxgd.so.1
+	ln -sf libxgd.so.1 $(INSTALL_LIB)/libxgd.so
+	mkdir -p $(INSTALL_INCLUDE)
 	$(INSTALL_DATA) gd.h $(INSTALL_INCLUDE)/gd.h
 	$(INSTALL_DATA) gdcache.h $(INSTALL_INCLUDE)/gdcache.h
 	$(INSTALL_DATA) gd_io.h $(INSTALL_INCLUDE)/gd_io.h
@@ -134,16 +134,20 @@
 gdtestttf: gdtestttf.o libxgd.a
 	$(CC) gdtestttf.o -o gdtestttf	$(LIBDIRS) $(LIBS)
 
-libxgd.a: gd.o gd_gd.o gd_gd2.o gd_io.o gd_io_dp.o gd_io_file.o gd_ss.o \
+OBJS=	gd.o gd_gd.o gd_gd2.o gd_io.o gd_io_dp.o gd_io_file.o gd_ss.o \
 	gd_io_ss.o gd_png.o gdxpm.o gdfontt.o gdfonts.o gdfontmb.o gdfontl.o \
-	gdfontg.o gdtables.o gdttf.o gdcache.o gdkanji.o \
-	gd.h gdfontt.h gdfonts.h gdfontmb.h gdfontl.h gdfontg.h
+	gdfontg.o gdtables.o gdttf.o gdcache.o gdkanji.o
+INCS=	gd.h gdfontt.h gdfonts.h gdfontmb.h gdfontl.h gdfontg.h
+
+libxgd.a: $(INCS) $(OBJS)
 	rm -f libxgd.a
-	$(AR) rc libxgd.a gd.o gd_gd.o gd_gd2.o gd_io.o gd_io_dp.o \
-		gd_io_file.o gd_ss.o gd_io_ss.o gd_png.o gdxpm.o \
-		gdfontt.o gdfonts.o gdfontmb.o gdfontl.o gdfontg.o \
-		gdtables.o gdttf.o gdcache.o gdkanji.o
+	$(AR) rc libxgd.a $(OBJS)
 	-@RANLIB@ libxgd.a
+
+libxgd.so.1:	$(INCS) $(OBJS:.o=.so)
+	$(CC) -shared -Wl,-soname,$@ -o $@ $(OBJS:.o=.so) $(LIBDIRS) $(LIBS)
+	ln -sf libxgd.so.1 libxgd.so
+
 
 clean:
 	rm -f *.o *.a ${PROGRAMS} core 
