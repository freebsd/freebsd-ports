PORTNAME=	sdl2_image
DISTVERSIONPREFIX=	release-
DISTVERSION=	2.8.8
PORTREVISION=	1
CATEGORIES=	graphics

MAINTAINER=	amdmi3@FreeBSD.org
COMMENT=	Simple library to load images of various formats as SDL surfaces
WWW=		https://github.com/libsdl-org/SDL_image

LICENSE=	ZLIB
LICENSE_FILE=	${WRKSRC}/LICENSE.txt

USES=		cmake sdl
USE_GITHUB=	yes
GH_ACCOUNT=	libsdl-org
GH_PROJECT=	SDL_image
USE_SDL=	sdl2
CMAKE_OFF=	SDL2IMAGE_DEPS_SHARED \
		SDL2IMAGE_SAMPLES \
		SDL2IMAGE_BACKEND_STB
CMAKE_ON=	SDL2IMAGE_STRICT
CMAKE_ARGS=	-DSDL2IMAGE_DEBUG_POSTFIX:STRING=
USE_LDCONFIG=	yes

PLIST_SUB=	LIBVERSION=0.${DISTVERSION:R:E}00.${DISTVERSION:E}

OPTIONS_DEFINE=	AVIF JPEG JXL PNG TIFF WEBP TEST
OPTIONS_DEFAULT=AVIF JPEG JXL PNG TIFF WEBP

AVIF_LIB_DEPENDS=	libavif.so:graphics/libavif
AVIF_CMAKE_BOOL=	SDL2IMAGE_AVIF

JPEG_USES=		jpeg
JPEG_CMAKE_BOOL=	SDL2IMAGE_JPG

JXL_LIB_DEPENDS=	libjxl.so:graphics/libjxl
JXL_CMAKE_BOOL=		SDL2IMAGE_JXL

PNG_LIB_DEPENDS=	libpng.so:graphics/png
PNG_CMAKE_BOOL=		SDL2IMAGE_PNG

TIFF_LIB_DEPENDS=	libtiff.so:graphics/tiff
TIFF_CMAKE_BOOL=	SDL2IMAGE_TIF

TEST_CMAKE_BOOL=	SDL2IMAGE_TESTS
TEST_CONFIGURE_ENV=	LOCALBASE="${LOCALBASE}"
TEST_LIB_DEPENDS=	libunwind.so:devel/libunwind
TEST_TEST_TARGET=	test
TEST_IMPLIES=		PNG JPEG  # does not build otherwise
TEST_BROKEN=		does not build  # XXX: probably devel/sdl20 problem

WEBP_LIB_DEPENDS=	libwebp.so:graphics/webp
WEBP_CMAKE_BOOL=	SDL2IMAGE_WEBP

post-extract:
	@${RM} -rf ${WRKSRC}/external

.include <bsd.port.mk>
