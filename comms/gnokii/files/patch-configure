--- configure.orig	Sun Oct 17 21:44:38 2004
+++ configure	Mon Dec 27 12:48:43 2004
@@ -26348,13 +26348,15 @@
 # First of all, check if the user has set any of the PTHREAD_LIBS,
 # etcetera environment variables, and if threads linking works using
 # them:
-if test x"$PTHREAD_LIBS$PTHREAD_CFLAGS" != x; then
+if test x"%%PTHREAD_LIBS%%%%PTHREAD_CFLAGS%%" != x; then
+	PTHREAD_CFLAGS="%%PTHREAD_CFLAGS%%"
+	PTHREAD_LIBS="%%PTHREAD_LIBS%%"
         save_CFLAGS="$CFLAGS"
-        CFLAGS="$CFLAGS $PTHREAD_CFLAGS"
+        CFLAGS="$CFLAGS %%PTHREAD_CFLAGS%%"
         save_LIBS="$LIBS"
-        LIBS="$PTHREAD_LIBS $LIBS"
-        echo "$as_me:$LINENO: checking for pthread_join in LIBS=$PTHREAD_LIBS with CFLAGS=$PTHREAD_CFLAGS" >&5
-echo $ECHO_N "checking for pthread_join in LIBS=$PTHREAD_LIBS with CFLAGS=$PTHREAD_CFLAGS... $ECHO_C" >&6
+        LIBS="%%PTHREAD_LIBS%% $LIBS"
+        echo "$as_me:$LINENO: checking for pthread_join in LIBS=%%PTHREAD_LIBS%% with CFLAGS=%%PTHREAD_CFLAGS%%" >&5
+echo $ECHO_N "checking for pthread_join in LIBS=%%PTHREAD_LIBS%% with CFLAGS=%%PTHREAD_CFLAGS%%... $ECHO_C" >&6
         cat >conftest.$ac_ext <<_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -26726,7 +26728,7 @@
 echo $ECHO_N "checking if more special flags are required for pthreads... $ECHO_C" >&6
         flag=no
         case "${host_cpu}-${host_os}" in
-                *-aix* | *-freebsd* | *-darwin*) flag="-D_THREAD_SAFE";;
+                *-aix* | *-darwin*) flag="-D_THREAD_SAFE";;
                 *solaris* | *-osf* | *-hpux*) flag="-D_REENTRANT";;
         esac
         echo "$as_me:$LINENO: result: ${flag}" >&5
@@ -27570,7 +27572,7 @@
 USE_LIBICAL="no"
 OLD_LIBS="$LIBS"
 OLD_CFLAGS="$CFLAGS"
-LIBS="$LIBS $ICAL_LIBS -lpthread -lical"
+LIBS="$LIBS $ICAL_LIBS -L/usr/local %%PTHREAD_LIBS%% -lical"
 CFLAGS="$CFLAGS $ICAL_CFLAGS"
 echo "$as_me:$LINENO: checking whether libical is installed" >&5
 echo $ECHO_N "checking whether libical is installed... $ECHO_C" >&6
