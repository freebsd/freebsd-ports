#!/bin/sh
set +x
cd $WRKSRC || exit 1

examples="angescao.tex angescax.tex avemaria.tex avemario.tex avemarix.tex \
         canticor.tex canticox.tex fantaisc.tex fantaisd.tex fantaisi.tex \
         gloriab.tex glorias.tex gloriax.tex gymnoman.tex ilestne.tex \
         ilestnex.tex marcello.tex onuitbri.tex parnasum.tex souvenir.tex \
         souvenix.tex traeumer.tex widor.tex widor_16.tex widor_20.tex"
              
cat > Makefile <<END
all:
	(cd systems/c-source; cc -O2 -o ../../musixflx musixflx.c)
	(cd tex; export TEXFONTS=${WRKSRC}/tfm:; \\
		initex '&tex musixtex.ins \dump')

install:
	install -c -s -o bin -g bin musixflx $PREFIX/bin/
	(cd $PREFIX/bin; ln -sf virtex musixtex)
	install -c -o bin -g bin mf/*.mf $PREFIX/share/texmf/metafont/
	install -c -o bin -g bin tfm/*.tfm $PREFIX/share/texmf/fonts/tfm/
	install -c -o bin -g bin tex/musixtex.fmt $PREFIX/share/texmf/web2c/
	install -c -o bin -g bin tex/*.tex tex/*.sty $PREFIX/share/texmf/tex/
	install -c -o bin -g bin doc/musixdoc.tex  doc/musixdoc.sty doc/backgrnd.sty \\
		$PREFIX/share/texmf/documentation/
	mkdir -p $PREFIX/share/texmf/documentation/musixtex.examples
	for f in $examples; do install -c -o bin -g bin  examples/\$\$f \\
		$PREFIX/share/texmf/documentation/musixtex.examples/; done
END

exit 0
