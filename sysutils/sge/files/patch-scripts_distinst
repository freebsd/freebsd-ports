
$FreeBSD$

--- scripts/distinst.orig
+++ scripts/distinst
@@ -35,7 +35,7 @@
 
 umask 022
 
-TOPFILES="3rd_party bin catman ckpt doc examples include inst_sge \
+TOPFILES="3rd_party bin ckpt doc examples include inst_sge \
           install_execd install_qmaster lib man mpi pvm qmon util utilbin"
 
 HASARCHDIR="bin lib examples/jobsbin utilbin"
@@ -66,9 +66,9 @@
 
 QMON_SHARED_LIBRARIES="libXbae libXicon libXmt libXspin libXtab"
 QMON_NEED_SHARED_LIBRARIES="libXltree"
-OPENSSL_SHARED_LIBRARIES="libcrypto libssl"
+#OPENSSL_SHARED_LIBRARIES="libcrypto libssl"
 
-BERKELEYDB_SHARED_LIBRARIES="libdb-4.2"
+#BERKELEYDB_SHARED_LIBRARIES="libdb-4.2"
 
 DRMAA_SHARED_LIBRARIES="libdrmaa"
 DRMAA_HEADER_FILES="libs/japi/drmaa.h"
@@ -420,6 +420,15 @@
 }
 
 #-------------------------------------------------------------------------
+# Symlink a program inplace rather then installing it.  Useful for
+# using OS versions of systems like OpenSSL.
+LinkFile()
+{
+	echo Linking $1
+	ln -s $1 $DEST_SGE_ROOT/${UTILPREFIX}/$DSTARCH/`basename $1`
+}
+
+#-------------------------------------------------------------------------
 # MAIN MAIN MAIN MAIN MAIN MAIN MAIN MAIN MAIN MAIN MAIN MAIN MAIN MAIN
 
 # How else I can find out that I'm user root?
@@ -730,17 +739,6 @@
 echo   "    Installing:" $PROG
 echo   " Architectures:" $ARCH
 echo   "Base directory:" $DEST_SGE_ROOT
-printf "   OK [Y/N][Y]: "
-
-read ans
-if [ "$ans" = y -o "$ans" = Y -o "$ans" = "" ]; then
-   :
-else
-   echo
-   echo Ciao
-   echo
-   exit 1
-fi
 
 echo
 
@@ -803,6 +801,9 @@
          instqmon=true
          instcommon=true
          ;;
+      noqmon)
+         instqmon=false
+         ;;
       sec)
          instsec=true
          instcommon=true
@@ -1006,25 +1007,25 @@
          Execute chmod 755 $DEST_SGE_ROOT/$MYRINETBASE/$f
       done
 
-      HPCBASE=mpi/SunHPCT5
-      Execute mkdir -p $DEST_SGE_ROOT/$HPCBASE
-      
-      for f in $SUNHPCTIGHT_FILES; do
-         Execute cp dist/$HPCBASE/$f $DEST_SGE_ROOT/$HPCBASE
-         Execute chmod 644 $DEST_SGE_ROOT/$HPCBASE/$f
-      done
-   
-      for f in $SUNHPCTIGHT_SCRIPTS; do
-         Execute cp dist/$HPCBASE/$f $DEST_SGE_ROOT/$HPCBASE
-         Execute chmod 755 $DEST_SGE_ROOT/$HPCBASE/$f
-      done
+#      HPCBASE=mpi/SunHPCT5
+#      Execute mkdir -p $DEST_SGE_ROOT/$HPCBASE
+#      
+#      for f in $SUNHPCTIGHT_FILES; do
+#         Execute cp dist/$HPCBASE/$f $DEST_SGE_ROOT/$HPCBASE
+#         Execute chmod 644 $DEST_SGE_ROOT/$HPCBASE/$f
+#      done
+#   
+#      for f in $SUNHPCTIGHT_SCRIPTS; do
+#         Execute cp dist/$HPCBASE/$f $DEST_SGE_ROOT/$HPCBASE
+#         Execute chmod 755 $DEST_SGE_ROOT/$HPCBASE/$f
+#      done
 
       Cleanup mpi
    fi
 
    if [ $instman = true ]; then
       echo Installing \"man/\" and \"catman/\"
-      Execute rm -rf $DEST_SGE_ROOT/man $DEST_SGE_ROOT/catman
+##      Execute rm -rf $DEST_SGE_ROOT/man $DEST_SGE_ROOT/catman
       Execute cp -r MANSBUILD_$MANSRCDIR/SEDMAN/man $DEST_SGE_ROOT
 
       if [ -d MANSBUILD_$MANSRCDIR/ASCMAN/catman ]; then
@@ -1146,7 +1147,7 @@
 
       for prog in $PROG; do
          case $prog in
-            jobs|ckpt|doc|inst_sge|utiltree|examples|man|mpi|pvm|qmontree|common|distcommon|utilbin)
+            jobs|ckpt|doc|inst_sge|utiltree|examples|man|mpi|pvm|noqmon|qmontree|common|distcommon|utilbin)
                : 
                ;;
             qmake)
@@ -1224,18 +1225,12 @@
          echo "---------------------------"
          for prog in $UTILITYBINARIES; do
             if [ $prog = openssl ]; then
-               if [ -f $OPENSSLBASE/$DSTARCH/bin/openssl ]; then
-                  InstallProg $OPENSSLBASE/$DSTARCH/bin/openssl
-               elif [ -f $OPENSSLBASE/bin/openssl ]; then
-                  InstallProg $OPENSSLBASE/bin/openssl
-               else
-                  echo \"openssl\" binary not found
-               fi
+               LinkFile $OPENSSLBASE/bin/openssl
             elif [ $prog = testsuidroot ]; then
                InstallProgSUID $prog
             elif [ $prog = berkeley_db_svc -o $prog = db_archive -o $prog = db_checkpoint -o $prog = db_deadlock -o $prog = db_dump -o $prog = db_load -o $prog = db_printlog -o $prog = db_recover -o $prog = db_stat -o $prog = db_upgrade -o $prog = db_verify ]; then
                if [ "$DSTARCH" != "win32-x86" ]; then
-                  InstallProg $BERKELEYDBBASE/$DSTARCH/bin/$prog
+                  LinkFile $BERKELEYDBBASE/bin/${prog}-4.2
                fi
             elif [ $prog = spoolinit -o $prog = spooldefaults ]; then
                if [ $instclassictargets = false ]; then
