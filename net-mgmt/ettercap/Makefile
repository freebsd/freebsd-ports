# Created by: George Reid <greid@ukug.uk.freebsd.org>
# $FreeBSD$

PORTNAME=	ettercap
PORTVERSION=	0.8.2
DISTVERSIONPREFIX=	v
PORTEPOCH=	1
CATEGORIES=	net-mgmt security

MAINTAINER=	sunpoet@FreeBSD.org
COMMENT=	Network sniffer/interceptor/injector/logger for switched LANs

LICENSE=	GPLv2
LICENSE_FILE=	${WRKSRC}/LICENSE

LIB_DEPENDS=	libnet.so:net/libnet

OPTIONS_DEFINE=	DESKTOP DOCS GTK2 IPV6 NCURSES PCRE PLUGINS SSL UTF8
OPTIONS_DEFAULT=GTK2 NCURSES PCRE PLUGINS SSL UTF8
OPTIONS_SUB=	yes
DESKTOP_DESC=	Install ettercap.desktop
NCURSES_DESC=	Ncurses interface
PCRE_DESC=	Use PCRE in filters
SSL_DESC=	SSH1 and SSL decryption support

CMAKE_ARGS=	-DBUNDLED_LIBS=OFF \
		-DHAVE_DLOPEN=ON \
		-DHAVE_PCAP=${LIBDIR} \
		-DHAVE_RESOLV=${LIBDIR} \
		-DINSTALL_SYSCONFDIR=${PREFIX}/etc \
		-DMAN_INSTALLDIR=${PREFIX}/man
LDFLAGS+=	${ICONV_LIB} -lnet -lpcap
MAKE_JOBS_UNSAFE=	yes
USE_LDCONFIG=	yes
USES=		bison cmake:outsource cpe iconv localbase:ldflags pkgconfig

DOCS=		AUTHORS CHANGELOG README README.BINARIES README.BUGS \
		README.GIT README.PLATFORMS THANKS TODO TODO.TESTING \
		doc/capture doc/decoders doc/dissectors doc/plugins doc/threads
PORTDATA=	*
PORTDOCS=	*

CPE_VENDOR=	${PORTNAME}_project

GH_ACCOUNT=	Ettercap
USE_GITHUB=	yes

DESKTOP_CMAKE_OFF=	-DINSTALL_DESKTOP=OFF
DESKTOP_CMAKE_ON=	-DINSTALL_DESKTOP=ON
DESKTOP_USES=		desktop-file-utils
NCURSES_CMAKE_OFF=	-DENABLE_CURSES=OFF
NCURSES_CMAKE_ON=	-DENABLE_CURSES=ON
NCURSES_USES=		ncurses
GTK2_CMAKE_OFF=		-DENABLE_GTK=OFF
GTK2_CMAKE_ON=		-DENABLE_GTK=ON
GTK2_USE=		GNOME=gtk20
IPV6_CMAKE_OFF=		-DENABLE_IPV6=OFF
IPV6_CMAKE_ON=		-DENABLE_IPV6=ON
PCRE_CMAKE_OFF=		-DHAVE_PCRE=OFF
PCRE_CMAKE_ON=		-DHAVE_PCRE=ON
PCRE_LIB_DEPENDS=	libpcre.so:devel/pcre
PLUGINS_BUILD_DEPENDS=	curl>=7.26.0:ftp/curl
PLUGINS_CMAKE_OFF=	-DENABLE_PLUGINS=OFF
PLUGINS_CMAKE_ON=	-DENABLE_PLUGINS=ON
PLUGINS_LIB_DEPENDS=	libcurl.so:ftp/curl
SSL_CMAKE_OFF=		-DENABLE_SSL=OFF
SSL_CMAKE_ON=		-DENABLE_SSL=ON
SSL_USES=		ssl
UTF8_CMAKE_OFF=		-DHAVE_UTF8=OFF
UTF8_CMAKE_ON=		-DHAVE_UTF8=ON \
			-DHAVE_ICONV=${ICONV_PREFIX}
UTF8_USES=		iconv

post-install:
	${INSTALL_DATA} ${STAGEDIR}${ETCDIR}/etter.conf ${STAGEDIR}${PREFIX}/etc/etter.conf.sample

post-install-DOCS-on:
	${MKDIR} ${STAGEDIR}${DOCSDIR}/
	cd ${WRKSRC}/ && ${INSTALL_DATA} ${DOCS} ${STAGEDIR}${DOCSDIR}/

.include <bsd.port.mk>
