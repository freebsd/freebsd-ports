# Created by: George Reid <greid@ukug.uk.freebsd.org>
# $FreeBSD$

PORTNAME=	ettercap
PORTVERSION=	0.8.0
PORTEPOCH=	1
CATEGORIES=	net-mgmt security
MASTER_SITES=	GH \
		GHC

MAINTAINER=	sunpoet@FreeBSD.org
COMMENT=	Network sniffer/interceptor/injector/logger for switched LANs

LICENSE=	GPLv2

LIB_DEPENDS=	libnet.so:${PORTSDIR}/net/libnet

OPTIONS_DEFINE=	DESKTOP DOCS GTK2 IPV6 NCURSES PCRE PLUGINS SSL UTF8
OPTIONS_DEFAULT=GTK2 NCURSES PCRE PLUGINS SSL UTF8
OPTIONS_SUB=	yes
DESKTOP_DESC=	Install ettercap.desktop
NCURSES_DESC=	Ncurses interface
PCRE_DESC=	Use PCRE in filters
SSL_DESC=	SSH1 and SSL decryption support

CMAKE_ARGS=	-DBUNDLED_LIBS=OFF \
		-DHAVE_LIBNET=${LOCALBASE}/lib/libnet11 \
		-DHAVE_PCAP=${LIBDIR} \
		-DHAVE_RESOLV=${LIBDIR} \
		-DLIBNET_INCLUDE_DIR=${LOCALBASE}/include/libnet11 \
		-DLIBNET_LIB_DIR=${LOCALBASE}/lib/libnet11 \
		-DLIBNET_LIBRARY=${LOCALBASE}/lib/libnet11 \
		-DMAN_INSTALLDIR=${PREFIX}/man
CMAKE_VERBOSE=	yes
LDFLAGS+=	-L${LIBDIR} -L${LOCALBASE}/lib -L${LOCALBASE}/lib/libnet11 ${ICONV_LIB} -lnet -lpcap
MAKE_JOBS_UNSAFE=	yes
USES=		bison cmake:outsource iconv pkgconfig

DOCS=		AUTHORS CHANGELOG README README.BINARIES README.BUGS \
		README.GIT README.PLATFORMS THANKS TODO TODO.TESTING \
		doc/capture doc/decoders doc/dissectors doc/threads

GH_ACCOUNT=	Ettercap
GH_PROJECT=	${PORTNAME}
GH_TAGNAME=	v${PORTVERSION}
GH_COMMIT=	99e062a
USE_GITHUB=	yes

DESKTOP_CMAKE_OFF=	-DINSTALL_DESKTOP=OFF
DESKTOP_CMAKE_ON=	-DINSTALL_DESKTOP=ON
DESKTOP_USES=		desktop-file-utils
NCURSES_CMAKE_OFF=	-DENABLE_CURSES=OFF
NCURSES_CMAKE_ON=	-DENABLE_CURSES=ON
NCURSES_USE=		NCURSES=yes
GTK2_CMAKE_OFF=		-DENABLE_GTK=OFF
GTK2_CMAKE_ON=		-DENABLE_GTK=ON
GTK2_PKGNAMESUFFIX=	-gtk2
GTK2_USE=		GNOME=gtk20
IPV6_CMAKE_OFF=		-DENABLE_IPV6=OFF
IPV6_CMAKE_ON=		-DENABLE_IPV6=ON
PCRE_CMAKE_OFF=		-DHAVE_PCRE=OFF
PCRE_CMAKE_ON=		-DHAVE_PCRE=ON
PCRE_LIB_DEPENDS=	libpcre.so:${PORTSDIR}/devel/pcre
PLUGINS_BUILD_DEPENDS=	curl>=7.26.0:${PORTSDIR}/ftp/curl
PLUGINS_LIB_DEPENDS=	libcurl.so:${PORTSDIR}/ftp/curl
PLUGINS_CMAKE_OFF=	-DENABLE_PLUGINS=OFF
PLUGINS_CMAKE_ON=	-DENABLE_PLUGINS=ON
SSL_CMAKE_OFF=		-DENABLE_SSL=OFF
SSL_CMAKE_ON=		-DENABLE_SSL=ON
SSL_USE=		OPENSSL=yes
UTF8_CMAKE_OFF=		-DHAVE_UTF8=OFF
UTF8_CMAKE_ON=		-DHAVE_UTF8=ON \
			-DHAVE_ICONV=${ICONV_PREFIX}
UTF8_USES=		iconv

.include <bsd.port.options.mk>

.if ${PORT_OPTIONS:MPLUGINS}
USE_LDCONFIG=	${PREFIX}/lib/ettercap
DOCS+=		doc/plugins
.else
USE_LDCONFIG=	yes
.endif

post-install:
	${INSTALL_DATA} ${WRKSRC}/share/etter.conf ${STAGEDIR}${PREFIX}/etc/etter.conf.sample
.if !exists(${PREFIX}/etc/etter.conf)
	${INSTALL_DATA} ${WRKSRC}/share/etter.conf ${STAGEDIR}${PREFIX}/etc/etter.conf
.endif
.if ${PORT_OPTIONS:MDOCS}
	${MKDIR} ${STAGEDIR}${DOCSDIR}/
	cd ${WRKSRC}/ && ${INSTALL_DATA} ${DOCS} ${STAGEDIR}${DOCSDIR}/
.endif

.include <bsd.port.mk>
