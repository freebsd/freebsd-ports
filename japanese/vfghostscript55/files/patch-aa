*** unix-gcc.mak.orig	Wed Dec  9 04:02:58 1998
--- unix-gcc.mak	Wed Dec  9 04:04:16 1998
***************
*** 213,219 ****
  # XLDFLAGS can be set from the command line.
  XLDFLAGS=
  
! LDFLAGS=$(XLDFLAGS)
  
  # Define any extra libraries to link into the executable.
  # ISC Unix 2.2 wants -linet.
--- 213,219 ----
  # XLDFLAGS can be set from the command line.
  XLDFLAGS=
  
! LDFLAGS=$(XLDFLAGS) -L/usr/local/lib
  
  # Define any extra libraries to link into the executable.
  # ISC Unix 2.2 wants -linet.
***************
*** 221,227 ****
  # SVR4 may need -lnsl.
  # (Libraries required by individual drivers are handled automatically.)
  
! EXTRALIBS=
  
  # Define the include switch(es) for the X11 header files.
  # This can be null if handled in some other way (e.g., the files are
--- 221,227 ----
  # SVR4 may need -lnsl.
  # (Libraries required by individual drivers are handled automatically.)
  
! EXTRALIBS=-lz
  
  # Define the include switch(es) for the X11 header files.
  # This can be null if handled in some other way (e.g., the files are
***************
*** 3679,3686 ****
  libpng95.dev: $(LIBPNG_MAK) $(ECHOGS_XE) pngwio.$(OBJ) crc32.dev
  	$(SETMOD) libpng95 pngwio.$(OBJ) -include crc32
  
! libpng96.dev: $(LIBPNG_MAK) $(ECHOGS_XE) pngwio.$(OBJ) crc32.dev
! 	$(SETMOD) libpng96 pngwio.$(OBJ) -include crc32
  #    Copyright (C) 1995, 1996, 1997 Aladdin Enterprises.  All rights reserved.
  # 
  # This file is part of Aladdin Ghostscript.
--- 3679,3686 ----
  libpng95.dev: $(LIBPNG_MAK) $(ECHOGS_XE) pngwio.$(OBJ) crc32.dev
  	$(SETMOD) libpng95 pngwio.$(OBJ) -include crc32
  
! libpng96.dev: $(LIBPNG_MAK) $(ECHOGS_XE) pngwio.$(OBJ) # crc32.dev
! 	$(SETMOD) libpng96 pngwio.$(OBJ) # -include crc32
  #    Copyright (C) 1995, 1996, 1997 Aladdin Enterprises.  All rights reserved.
  # 
  # This file is part of Aladdin Ghostscript.
***************
*** 3761,3767 ****
  zlibe_1.dev: $(MAKEFILE) $(ZLIB_MAK) $(ECHOGS_XE)
  	$(SETMOD) zlibe_1 -lib $(ZLIB_NAME)
  
! zlibe_=adler32.$(OBJ) deflate.$(OBJ) trees.$(OBJ)
  zlibe_0.dev: $(ZLIB_MAK) $(ECHOGS_XE) zlibc.dev $(zlibe_)
  	$(SETMOD) zlibe_0 $(zlibe_)
  	$(ADDMOD) zlibe_0 -include zlibc
--- 3761,3767 ----
  zlibe_1.dev: $(MAKEFILE) $(ZLIB_MAK) $(ECHOGS_XE)
  	$(SETMOD) zlibe_1 -lib $(ZLIB_NAME)
  
! zlibe_=
  zlibe_0.dev: $(ZLIB_MAK) $(ECHOGS_XE) zlibc.dev $(zlibe_)
  	$(SETMOD) zlibe_0 $(zlibe_)
  	$(ADDMOD) zlibe_0 -include zlibc
***************
*** 3808,3818 ****
  
  zlibd1_=infblock.$(OBJ) infcodes.$(OBJ) inffast.$(OBJ)
  zlibd2_=inflate.$(OBJ) inftrees.$(OBJ) infutil.$(OBJ)
! zlibd_ = $(zlibd1_) $(zlibd2_)
! zlibd_0.dev: $(ZLIB_MAK) $(ECHOGS_XE) zlibc.dev $(zlibd_)
! 	$(SETMOD) zlibd_0 $(zlibd1_)
! 	$(ADDMOD) zlibd_0 -obj $(zlibd2_)
! 	$(ADDMOD) zlibd_0 -include zlibc
  
  infblock.$(OBJ): $(ZSRC)infblock.c $(ZDEP) zutil.h
  	$(CP_) $(ZSRC)infblock.c .
--- 3808,3818 ----
  
  zlibd1_=infblock.$(OBJ) infcodes.$(OBJ) inffast.$(OBJ)
  zlibd2_=inflate.$(OBJ) inftrees.$(OBJ) infutil.$(OBJ)
! zlibd_=
! zlibd_0.dev: $(ZLIB_MAK) $(ECHOGS_XE) zlibc.dev
! 	$(SETMOD) zlibd_0
! 	$(ADDMOD) zlibd_0
! 	$(ADDMOD) zlibd_0
  
  infblock.$(OBJ): $(ZSRC)infblock.c $(ZDEP) zutil.h
  	$(CP_) $(ZSRC)infblock.c .
***************
*** 4799,4807 ****
  lbp8.dev: $(lbp8_) page.dev
  	$(SETPDEV) lbp8 $(lbp8_)
  
- lips3.dev: $(lbp8_) page.dev
- 	$(SETPDEV) lips3 $(lbp8_)
- 
  gdevlbp8.$(OBJ): gdevlbp8.c $(PDEVH)
  
  ### ----------- The DEC LN03/LA50/LA70/LA75 printer devices ------------ ###
--- 4799,4804 ----
***************
*** 5458,5468 ****
  
  # ---------------- Kanji Font Utility ---------------- #
  
! kanji_=kfutil.$(OBJ)
  kanji.dev: $(kanji_)
  	$(SETMOD) kanji $(kanji_)
  
  kfutil.$(OBJ): kfutil.c $(OP) $(gsmatrix_h)
  
  # ---------------- Kanji Font(VFlib) ---------------- #
  
--- 5455,5468 ----
  
  # ---------------- Kanji Font Utility ---------------- #
  
! kanji_=kfutil.$(OBJ) zkfimpath.$(OBJ)
  kanji.dev: $(kanji_)
  	$(SETMOD) kanji $(kanji_)
+ 	$(ADDMOD) kanji -oper zkfimagepath
  
  kfutil.$(OBJ): kfutil.c $(OP) $(gsmatrix_h)
+ zkfimpath.$(OBJ): zkfimpath.c $(OP) $(gsmatrix_h) $(gspath_h) \
+ 					$(igstate_h) $(store_h)
  
  # ---------------- Kanji Font(VFlib) ---------------- #
  
***************
*** 5470,5479 ****
  kfvflib.dev: $(kfvflib_) kanji.dev
  	$(SETMOD) kfvflib $(kfvflib_)
  	$(ADDMOD) kfvflib -oper zkfVFlib
! 	$(ADDMOD) kfvflib -ps kfvflib
! 	$(ADDMOD) kfvflib -lib VFlib
  
  zkfvflib.$(OBJ): zkfvflib.c 
  
  #    Copyright (C) 1990, 1995, 1996, 1997 Aladdin Enterprises.  All rights reserved.
  # 
--- 5470,5482 ----
  kfvflib.dev: $(kfvflib_) kanji.dev
  	$(SETMOD) kfvflib $(kfvflib_)
  	$(ADDMOD) kfvflib -oper zkfVFlib
! 	$(ADDMOD) kfvflib -ps kfvflib kfvfbm
! 	$(ADDMOD) kfvflib -lib VFlib2
! ## VFlib without freetype
! 	$(ADDMOD) kfvflib -lib ttf    
  
  zkfvflib.$(OBJ): zkfvflib.c 
+ 	${CC} ${CFLAGS} -I${PREFIX}/include/ -c zkfvflib.c
  
  #    Copyright (C) 1990, 1995, 1996, 1997 Aladdin Enterprises.  All rights reserved.
  # 
***************
*** 5611,5616 ****
--- 5614,5622 ----
  	./echogs -w ldt.tr -n - $(CCLD) $(LDFLAGS) $(XLIBDIRS) -o $(GS_XE)
  	./echogs -a ldt.tr -n -s gs.$(OBJ) -s
  	cat ld.tr >>ldt.tr
+ .if ${PORTOBJFORMAT} == "elf"
+ 	echo '-lICE -lSM \' >>ldt.tr
+ .endif
  	./echogs -a ldt.tr -s - $(EXTRALIBS) -lm
  	LD_RUN_PATH=$(XLIBDIR); export LD_RUN_PATH; \
  	XCFLAGS= XINCLUDE= XLDFLAGS= XLIBDIRS= XLIBS= \
