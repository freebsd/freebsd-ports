#!/bin/sh
#
# Since FreeBSD does not supply a user for running an MTA in a sandbox
# by default, use user 'exim', adding it if it does not exist.  Even
# if FreeBSD supplied an MTA user, it's neglected to do so for so long
# that every sandboxed MTA under the sun uses its own user, so user
# 'exim' should probably be used forever.
#
# Modern FreeBSD systems already have a group mail.
#
# $FreeBSD$
#

PKG_PREFIX=${PKG_PREFIX:=/usr/local}

uid=26
gid=6
user=mailnull
group=mail

if [ "$2" = "PRE-INSTALL" ]; then
	# uid=26(mailnull) gid=26(mailnull) groups=26(mailnull)
	if ! /usr/bin/id ${uid} | /usr/bin/grep -q "uid=${uid}(${user})"; then
		echo "Exim requires user ${user} (UID ${uid}).  Please update your system." 1>&2
		exit 1
	fi
	if ! /usr/bin/grep -q "^${group}:[^:]*:${gid}:" < /etc/group; then
		echo "Exim requires group ${group} (GID ${gid}).  Please update your system." 1>&2
		exit 1
	fi
fi

# This is naughty, since the directory we create won't be removed along
# with Exim.  However, logfiles should probably stick around after Exim
# is removed, until the administrator is sure he doesn't want them
# any more.
#
mkdir -p /var/log/exim
chown ${user}:${group} /var/log/exim
