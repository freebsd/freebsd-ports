# Created by: Alexander Lunkov <lunkov@gmail.com>
# $FreeBSD$

PORTNAME=	cas
PORTVERSION=	3.5.6
CATEGORIES=	www devel
MASTER_SITES=	http://cas.havoc.ru/download/

MAINTAINER=	lunkov@gmail.com
COMMENT=	C++ Application Server, version 2

LIB_DEPENDS=	expat:${PORTSDIR}/textproc/expat2 \
		pcre:${PORTSDIR}/devel/pcre       \
		ctpp2:${PORTSDIR}/textproc/ctpp2

USE_CMAKE=	yes
USE_LDCONFIG=	yes
USE_ICONV=	yes
WITHOUT_NLS=	yes
MAKE_JOBS_SAFE=	yes

OPTIONS_DEFINE=	DEBUG_MODE               \
		ENABLE_OPTIMIZATION      \
		BUILD_APACHE2X_MODULE    \
		BUILD_CURL_XMLRPC_CLIENT \
		INSTALL_EXAMPLE_MODULES  \
		INSTALL_CAS_LIBRARY      \
		INSTALL_CAS_MODULES      \
		INSTALL_CAS_HEADERS      \
		INSTALL_CAS_CONFIGS      \
		INSTALL_CAS_BINARIES     \
		INSTALL_CAS_DATA

OPTIONS_DEFAULT=ENABLE_OPTIMIZATION      \
		BUILD_APACHE2X_MODULE    \
		BUILD_CURL_XMLRPC_CLIENT \
		INSTALL_CAS_LIBRARY      \
		INSTALL_CAS_MODULES      \
		INSTALL_CAS_HEADERS      \
		INSTALL_CAS_CONFIGS      \
		INSTALL_CAS_BINARIES     \
		INSTALL_CAS_DATA

DEBUG_MODE_DESC=		Enable debug output
ENABLE_OPTIMIZATION_DESC=	Enable optimization
BUILD_APACHE2X_MODULE_DESC=	Build Apache 2.x module
BUILD_CURL_XMLRPC_CLIENT_DESC=	Build cURL-based XMLRPC client
INSTALL_EXAMPLE_MODULES_DESC= 	Install example modules
INSTALL_CAS_LIBRARY_DESC=	Install CAS library (libcas)
INSTALL_CAS_MODULES_DESC=	Install CAS modules
INSTALL_CAS_HEADERS_DESC=	Install CAS headers
INSTALL_CAS_CONFIGS_DESC=	Install CAS configuration files
INSTALL_CAS_BINARIES_DESC=	Install CAS binaries
INSTALL_CAS_DATA_DESC=		Install CAS data files

PLIST_SUB+=	PORTVERSION=${PORTVERSION}

.include <bsd.port.options.mk>

.if ${PORT_OPTIONS:MDEBUG_MODE}
CMAKE_ARGS+=	-DDEBUG_MODE=ON
.else
CMAKE_ARGS+=	-DDEBUG_MODE=OFF
.endif

.if ${PORT_OPTIONS:MENABLE_OPTIMIZATION}
CMAKE_ARGS+=	-DENABLE_OPTIMIZATION=ON
.else
CMAKE_ARGS+=	-DENABLE_OPTIMIZATION=OFF
.endif

CMAKE_ARGS+=	-DBUILD_APACHE13_MODULE=OFF

.if ${PORT_OPTIONS:MBUILD_APACHE2X_MODULE}
USE_APACHE=	22
CMAKE_ARGS+=	-DBUILD_APACHE2X_MODULE=ON
PLIST_SUB+=	APACHE2X_MODULE=""
.else
CMAKE_ARGS+=	-DBUILD_APACHE2X_MODULE=OFF
PLIST_SUB+=	APACHE2X_MODULE="@comment "
.endif

.if ${PORT_OPTIONS:MBUILD_CURL_XMLRPC_CLIENT}
LIB_DEPENDS+=	curl:${PORTSDIR}/ftp/curl
CMAKE_ARGS+=	-DBUILD_CURL_XMLRPC_CLIENT=ON
PLIST_SUB+=	CURL_XMLRPC_CLIENT=""
.else
CMAKE_ARGS+=	-DBUILD_CURL_XMLRPC_CLIENT=OFF
PLIST_SUB+=	CURL_XMLRPC_CLIENT="@comment "
.endif

.if ${PORT_OPTIONS:MINSTALL_EXAMPLE_MODULES}
CMAKE_ARGS+=	-DINSTALL_EXAMPLE_MODULES=ON
PLIST_SUB+=	EXAMPLE_MODULES=""
.else
CMAKE_ARGS+=	-DINSTALL_EXAMPLE_MODULES=OFF
PLIST_SUB+=	EXAMPLE_MODULES="@comment "
.endif

.if ${PORT_OPTIONS:MINSTALL_CAS_LIBRARY}
CMAKE_ARGS+=	-DINSTALL_CAS_LIBRARY=ON
PLIST_SUB+=	CAS_LIBRARY=""
.else
CMAKE_ARGS+=	-DINSTALL_CAS_LIBRARY=OFF
PLIST_SUB+=	CAS_LIBRARY="@comment "
.endif

.if ${PORT_OPTIONS:MINSTALL_CAS_MODULES}
CMAKE_ARGS+=	-DINSTALL_CAS_MODULES=ON
PLIST_SUB+=	CAS_MODULES=""
.else
CMAKE_ARGS+=	-DINSTALL_CAS_MODULES=OFF
PLIST_SUB+=	CAS_MODULES="@comment "
.endif

.if ${PORT_OPTIONS:MINSTALL_CAS_HEADERS}
CMAKE_ARGS+=	-DINSTALL_CAS_HEADERS=ON
PLIST_SUB+=	CAS_HEADERS=""
.else
CMAKE_ARGS+=	-DINSTALL_CAS_HEADERS=OFF
PLIST_SUB+=	CAS_HEADERS="@comment "
.endif

.if ${PORT_OPTIONS:MINSTALL_CAS_CONFIGS}
CMAKE_ARGS+=	-DINSTALL_CAS_CONFIGS=ON
PLIST_SUB+=	CAS_CONFIGS=""
.else
CMAKE_ARGS+=	-DINSTALL_CAS_CONFIGS=OFF
PLIST_SUB+=	CAS_CONFIGS="@comment "
.endif

.if ${PORT_OPTIONS:MINSTALL_CAS_BINARIES}
CMAKE_ARGS+=	-DINSTALL_CAS_BINARIES=ON
PLIST_SUB+=	CAS_BINARIES=""
.else
CMAKE_ARGS+=	-DINSTALL_CAS_BINARIES=OFF
PLIST_SUB+=	CAS_BINARIES="@comment "
.endif

.if ${PORT_OPTIONS:MINSTALL_CAS_DATA}
CMAKE_ARGS+=	-DINSTALL_CAS_DATA=ON
PLIST_SUB+=	CAS_DATA=""
.else
CMAKE_ARGS+=	-DINSTALL_CAS_DATA=OFF
PLIST_SUB+=	CAS_DATA="@comment "
.endif

.include <bsd.port.mk>
