#!/bin/sh
#
# $FreeBSD$
#
# Date created:			Mon Nov 29, 2003
# Whom:				Thierry Thomas (<thierry@pompo.net>)
# Fix the chrome registry.

umask 022
PATH=/bin:/usr/bin:/usr/local/bin

[ "x$1" = "x" ] && exit 1
[ "x$2" != "xPOST-INSTALL" ] && exit 0

MOZDIR=%%MOZDIR%%
REGXPCOM=${MOZDIR}/regxpcom
REGCHROME=${MOZDIR}/regchrome
FIREFOX=${MOZDIR}/firefox-bin

echo "===> Building Chrome's registry..."
rm -rf ${MOZDIR}/chrome/overlayinfo
rm -f ${MOZDIR}/chrome/*.rdf
mkdir -p ${MOZDIR}/chrome/overlayinfo
rm -f ${MOZDIR}/component.reg
rm -rf ${MOZDIR}/extensions

cd ${MOZDIR} || exit 1
./run-mozilla.sh ${REGXPCOM} || true
./run-mozilla.sh ${REGCHROME} || true

# Instantiate the extension space as root.
su - root -c "env PATH=${PATH} %%X11BASE%%/bin/xinit %%MOZDIR%%/run-mozilla.sh ${FIREFOX} -install-global-extension -- %%X11BASE%%/bin/Xvfb :1001" > /dev/null 2>&1
su - root -c "env PATH=${PATH} %%X11BASE%%/bin/xinit %%MOZDIR%%/run-mozilla.sh ${FIREFOX} -install-global-theme -- %%X11BASE%%/bin/Xvfb :1001" > /dev/null 2>&1

exit 0
