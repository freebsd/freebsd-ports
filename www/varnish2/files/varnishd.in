#!/bin/sh
#
# $FreeBSD$
#

# PROVIDE: varnishd
# REQUIRE: DAEMON
# KEYWORD: shutdown

#
# Add the following lines to /etc/rc.conf to enable varnishd:
#
#varnishd_enable="YES"
#
# Configuration variables and their default values:
#
#varnishd_listen=":6081"
#varnishd_config="%%PREFIX%%/etc/varnish/default.vcl"
#varnishd_telnet="localhost:6082"
#varnishd_storage="file,/tmp,50%"
#varnishd_user="www"
#varnishd_group="www"
#varnishd_flags="-P ${pidfile} -a ${varnishd_listen} -f ${varnishd_config} -T ${varnishd_telnet} -s ${varnishd_storage} -u ${varnishd_user} -g ${varnishd_group}"
#
# See varnishd(1) for a detailed overview of command-line options.
#

. %%RC_SUBR%%

name=varnishd
rcvar=`set_rcvar`

command="%%PREFIX%%/sbin/varnishd"
pidfile="/var/run/${name}.pid"

# read configuration and set defaults
load_rc_config ${name}
: ${varnishd_enable="NO"}
: ${varnishd_listen=":6081"}
: ${varnishd_config="%%PREFIX%%/etc/varnish/default.vcl"}
: ${varnishd_telnet="localhost:6082"}
: ${varnishd_storage="file,/tmp,50%"}
: ${varnishd_user="www"}
: ${varnishd_group="www"}
: ${varnishd_flags="-P ${pidfile} -a ${varnishd_listen} -f ${varnishd_config} -T ${varnishd_telnet} -s ${varnishd_storage} -u ${varnishd_user} -g ${varnishd_group}"}

# If we leave these set, rc.subr will su to them before starting
# varnishd, which is not what we want.
unset varnishd_user
unset varnishd_group

run_rc_command "$1"
