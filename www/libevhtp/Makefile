# $FreeBSD$

PORTNAME=	libevhtp
PORTVERSION=	1.2.10
CATEGORIES=	www

MAINTAINER=	ultima1252@gmail.com
COMMENT=	Flexible replacement for libevent httpd API

LICENSE=	BSD3CLAUSE
LICENSE_FILE=	${WRKSRC}/LICENSE

LIB_DEPENDS=	libevent.so:${PORTSDIR}/devel/libevent2

USE_GITHUB=	yes
GH_ACCOUNT=	ellzey
GH_TAGNAME=	ba4c44e

USES=		cmake:outsource
USE_LDCONFIG=	yes
CMAKE_ARGS=	-DCMAKE_INCLUDE_PATH:PATH=include/event2 \
		-DCMAKE_LIBRARY_PATH:PATH=lib/event2
CMAKE_BUILD_TYPE=	Release

OPTIONS_DEFINE=	EVHTP_DISABLE_SSL EVHTP_DISABLE_EVTHR EVHTP_DISABLE_REGEX \
				EVHTP_BUILD_SHARED EVHTP_USE_DEFER_ACCEPT
EVHTP_DISABLE_SSL_DESC=		Disable ssl support

EVHTP_DISABLE_SSL_CMAKE_ON=	-DEVHTP_DISABLE_SSL:STRING=ON
EVHTP_DISABLE_SSL_CMAKE_OFF=	-DEVHTP_DISABLE_SSL:STRING=OFF
EVHTP_DISABLE_EVTHR_DESC=	Disable evthread support
EVHTP_DISABLE_EVTHR_CMAKE_ON=	-DEVHTP_DISABLE_EVTHR:STRING=ON
EVHTP_DISABLE_EVTHR_CMAKE_OFF=	-DEVHTP_DISABLE_EVTHR:STRING=OFF
EVHTP_DISABLE_REGEX_DESC=	Disable regex support
EVHTP_DISABLE_REGEX_CMAKE_ON=	-DEVHTP_DISABLE_REGEX:STRING=ON
EVHTP_DISABLE_REGEX_CMAKE_OFF=	-DEVHTP_DISABLE_REGEX:STRING=OFF
EVHTP_BUILD_SHARED_DESC=	Build shared library too
EVHTP_BUILD_SHARED_CMAKE_ON=	-DEVHTP_BUILD_SHARED:STRING=ON
EVHTP_BUILD_SHARED_CMAKE_OFF=	-DEVHTP_BUILD_SHARED:STRING=OFF
EVHTP_USE_DEFER_ACCEPT_DESC=	Enable TCP_DEFER_ACCEPT
EVHTP_USE_DEFER_ACCEPT_CMAKE_ON=	-DEVHTP_USE_DEFER_ACCEPT:STRING=ON
EVHTP_USE_DEFER_ACCEPT_CMAKE_OFF=	-DEVHTP_USE_DEFER_ACCEPT:STRING=OFF

OPTIONS_DEFAULT=	EVHTP_BUILD_SHARED

.include <bsd.port.options.mk>

PLIST_FILES=	include/evhtp.h \
		include/evhtp-config.h \
		include/htparse.h

.if !exists(${LOCALBASE}/include/onigposix.h) && !${PORT_OPTIONS:MEVHTP_DISABLE_REGEX}
PLIST_FILES+=	include/onigposix.h
.endif

.if !${PORT_OPTIONS:MEVHTP_DISABLE_EVTHR}
PLIST_FILES+=	include/evthr.h
.endif

.if ${PORT_OPTIONS:MEVHTP_BUILD_SHARED}
PLIST_FILES+=	lib/libevhtp.so
.else
PLIST_FILES+=	lib/libevhtp.a
.endif

.include <bsd.port.mk>
