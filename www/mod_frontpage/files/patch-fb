--- frontpage/version4.0/fp_install.sh.orig	Mon Aug 14 11:51:36 2000
+++ frontpage/version4.0/fp_install.sh	Wed Mar  7 22:16:28 2001
@@ -48,7 +48,8 @@
 {
   VERSION="4.0"
   PATH=".:/bin:/usr/bin:/sbin:/usr/sbin:/usr/ucb:/etc:/usr/bsd"
-  INSTALLDIRDEFAULT="/usr/local/frontpage"
+  AP_TARGET=`PREFIX/sbin/apxs -q TARGET`
+  INSTALLDIRDEFAULT="PREFIX/frontpage"
 
 case "`echo 'x\c'`" in
    'x\c')   echo="echo -n"    nnl= ;;      #BSD
@@ -129,7 +130,7 @@
 checkuser()
 {
  #
- # Make sure we are not running as root.
+ # Make sure we are running as root.
  #
 
 whoami=`whoami 2>/dev/null` || whoami=`/usr/bin/id | sed -e ' s/).*//; s/^.*(//;'`
@@ -322,27 +323,27 @@
  
  retval=0
 
- echo 
- echo "Where would you like to install the FrontPage Extensions.  If you" 
- echo "select a location other than /usr/local/frontpage/ then a symbolic" 
- echo "link will be created from /usr/local/frontpage/ to the location that" 
- echo "is chosen." 
- echo 
- $echo "FrontPage Extensions directory [/usr/local/frontpage/]:  ${nnl}" 
- read installdir
+# echo 
+# echo "Where would you like to install the FrontPage Extensions.  If you" 
+# echo "select a location other than /usr/local/frontpage/ then a symbolic" 
+# echo "link will be created from /usr/local/frontpage/ to the location that" 
+# echo "is chosen." 
+# echo 
+# $echo "FrontPage Extensions directory [${INSTALLDIRDEFAULT}]:  ${nnl}" 
+# read installdir
  
- if [ "$installdir" = "" ]
- then
+# if [ "$installdir" = "" ]
+# then
     installdir=$INSTALLDIRDEFAULT
- fi
+# fi
  installdir=`dirname $installdir`/`basename $installdir`
 
- if [ ! -d "$installdir" ]
- then
-    echo "Creating $installdir" 
-    if mkdir "$installdir"
-    then
-       echo "Directory $installdir has been created." 
+# if [ ! -d "$installdir" ]
+# then
+#    echo "Creating $installdir" 
+#    if mkdir "$installdir"
+#    then
+#       echo "Directory $installdir has been created." 
        if chmod "$prot" "$installdir"
        then 
           echo "Directory $installdir chmoded to $prot." 
@@ -350,22 +351,22 @@
           echo "ERROR:  Unable to chmod $installdir to $prot." 
           retval=1
        fi  
-    else
-       echo "ERROR:  Unable to create $installdir!" 
-       retval=1
-    fi
- else
-    echo "WARNING:  Directory $installdir already exists." 
-    echo "Installation will overwrite existing files." 
-    echo 
-
-    myprompt 'yYnN' "Continue the installation (y/n)" "N"
-    echo 
-    if [ $answer = n ] || [ $answer = N ]
-    then
-       exit 0
-    fi
- fi
+#    else
+#       echo "ERROR:  Unable to create $installdir!" 
+#       retval=1
+#    fi
+# else
+#    echo "WARNING:  Directory $installdir already exists." 
+#    echo "Installation will overwrite existing files." 
+#    echo 
+
+#    myprompt 'yYnN' "Continue the installation (y/n)" "N"
+#    echo 
+#    if [ $answer = n ] || [ $answer = N ]
+#    then
+#       exit 0
+#    fi
+# fi
  
  if [ "$installdir" != "/usr/local/frontpage" ]
  then
@@ -415,7 +416,7 @@
  vtfile="fp40.$machine.tar"
  echo "Platform is $machine." 
  
- vtfilelocation="`pwd`/"
+ vtfilelocation="/usr/ports/distfiles/"
 
  getextfilename $vtfilelocation $vtfile || return 1
 
@@ -539,7 +540,7 @@
         upgrade="no"
         echo "For details on how to upgrade servers manually, please see" 
         echo "the Server Extension Resource Kit (SERK), located in"
-        echo "/usr/local/frontpage/version${VERSION}/serk"
+        echo "MOD_FPDOCDIR/serk"
         echo
         return $retval
     else
@@ -656,10 +657,15 @@
       *pache*) getHttpDirective $configfile AccessConfig $port
                if [ "$param" != "" ]
                then
-                   file=`basename $param`
-                   accessconffile="${configfiledir}${file}"
+                   if [ "${param}" = "/dev/null" ]
+                   then
+                       accessconffile="${configfile}"
+                   else
+                       file=`basename $param`
+                       accessconffile="${configfiledir}${file}"
+                   fi
                else
-                   accessconffile="${configfiledir}access.conf"
+                   accessconffile="${configfiledir}conf/access.conf"
                fi
 
                if [ ! -f "$accessconffile" ]
@@ -1106,18 +1112,29 @@
 
  webname="/"
 
+ defconfigfile="PREFIX/etc/apache/${AP_TARGET}.conf"
+
  configfile=""
  while ( [ "$configfile" = "" ] || [ ! -f $configfile ] )
  do
-     $echo "Server config filename:  ${nnl}" 
+     $echo "Server config filename: [$defconfigfile] ${nnl}" 
      read configfile
- done
+     if [ "$configfile" = "" ]
+     then
+         configfile=$defconfigfile
+     fi
+done
 
+ defadmin="fpadmin"
  admin=""
  until [ "$admin" != "" ]
  do
-     $echo "FrontPage Administrator's user name:  ${nnl}" 
+     $echo "FrontPage Administrator's user name: [$defadmin] ${nnl}" 
      read admin
+     if [ "$admin" = "" ]
+     then
+         admin=$defadmin
+     fi
  done
 
  getparam Port $configfile
@@ -1132,6 +1149,39 @@
  getparam User $configfile
  defwebowner=$param
 
+ if [ "$defwebowner" = "" ]
+ then
+     getHttpDirective $configfile ResourceConfig $port
+     if [ "$param" != "" ]
+     then
+         if [ "${param}" = "/dev/null" ]
+         then
+             resconffile="${configfile}"
+         else
+             file=`basename $param`
+             resconffile="${configfiledir}${file}"
+         fi
+     else
+         resconffile="${configfiledir}srm.conf"
+     fi
+
+     if [ ! -f "$resconffile" ]
+     then
+         echo "ERROR: $resconffile does not exist!"
+         return 1
+     fi
+
+     getparam DocumentRoot $resconffile
+     docroot=$param
+     if [ ! -d "$docroot" ]
+     then
+         echo "ERROR: $docroot does not exist!"
+         return 1
+     fi
+
+     defwebowner=`$lsg ${docroot}${service} | $awk ' { print $3}'`
+ fi
+
  weconfigfile="${installdir}/we${port}.cnf"
 
  webowner=""
@@ -1147,6 +1197,12 @@
 
  getparam Group $configfile
  defgroup=$param
+
+ if [ "$defgroup" = "" ]
+ then
+     defgroup=`$lsg ${docroot}${service} | $awk ' { print $4}'`
+ fi
+
  webgroup=""
  until [ "$webgroup" != "" ]
  do
@@ -1158,6 +1214,8 @@
         webgroup=$defgroup
      fi
  done
+
+defservertypenum="3"
  
  until [ "$servertype" != "" ]
  do
@@ -1168,9 +1226,13 @@
      echo "    4.  netscape-fasttrack" 
      echo "    5.  netscape-enterprise"
      echo "    6.  stronghold"
-     $echo "What type of Server is this:  ${nnl}" 
+     $echo "What type of Server is this: [$defservertypenum] ${nnl}" 
      read servertypenum
      echo 
+     if [ "$servertypenum" = "" ]
+     then
+        servertypenum=$defservertypenum
+     fi
 
      case $servertypenum in
           "1") servertype="ncsa" ;;
@@ -1546,6 +1608,8 @@
         read admin
     done
 
+    defservertypenum="3"
+
     until [ "$servertype" != "" ]
     do
      echo 
@@ -1555,9 +1619,13 @@
      echo "    4.  netscape-fasttrack" 
      echo "    5.  netscape-enterprise" 
      echo "    6.  stronghold"
-     $echo "What type of Server is this:  ${nnl}" 
+     $echo "What type of Server is this: [$defservertypenum] ${nnl}" 
      read servertypenum
      echo 
+     if [ "$servertypenum" = "" ]
+     then
+        servertypenum=$defservertypenum
+     fi
 
      case $servertypenum in
           "1") servertype="ncsa" ;;
@@ -2024,7 +2092,6 @@
  then
     getHttpRootDirective $configfile $directive
  fi 
-
 }
 
 getnetscapedocroot()
@@ -2217,7 +2284,7 @@
 
 initialize
 step1
-step2
+#step2
 step3
 #
 # Run the external permissions script.
