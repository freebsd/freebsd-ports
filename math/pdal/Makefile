# Created by: bart <coder@tuxfamily.org>
# $FreeBSD$

PORTNAME=	pdal
PORTVERSION=	1.1.0
PORTREVISION=	3
CATEGORIES=	math databases graphics

MAINTAINER=	coder@tuxfamily.org
COMMENT=	Library for translating and manipulating point cloud data

LICENSE=	BSD3CLAUSE
LICENSE_FILE=	${WRKSRC}/LICENSE.txt

LIB_DEPENDS=	libgdal.so:graphics/gdal \
		libgeos.so:graphics/geos \
		libboost_thread.so:devel/boost-libs

BROKEN=		does not build (error: typedef redefinition with different types ('struct GTIFS *' vs 'struct gtiff'))

USES=		cmake:outsource compiler:c++11-lib pathfix pkgconfig
USE_LDCONFIG=	yes
USE_GITHUB=	yes
GH_ACCOUNT=	${PORTNAME:tu}
GH_PROJECT=	${GH_ACCOUNT}

# Unhide std::to_string() to fix build with GCC (see ports/193528 for details).
CXXFLAGS+=	-D_GLIBCXX_USE_C99

OPTIONS_DEFINE=	GEOTIFF LIBXML2 LASZIP APPS BASH ATTRIBUTE \
		ICEBRIDGE PGPOINTCLOUD SQLITE \
		PYTHON TESTS
OPTIONS_DEFAULT=	GEOTIFF LIBXML2 LASZIP APPS
#Plugins with lib not in port:
#RivLib, Matlab, MrSID, CPD, GeoWave, GreyHound, HexBin
OPTIONS_SUB=	yes

PGPOINTCLOUD_DESC=	Enable Coherent PostgreSQL Point Cloud plugin
PGPOINTCLOUD_CMAKE_ON=	-DBUILD_PLUGIN_PGPOINTCLOUD:BOOL=TRUE
PGPOINTCLOUD_USES=	pgsql
PGPOINTCLOUD_CMAKE_OFF=	-DBUILD_PLUGIN_PGPOINTCLOUD:BOOL=FALSE

SQLITE_DESC=	Enable SQLite plugin
SQLITE_CMAKE_ON=	-DBUILD_PLUGIN_SQLITE:BOOL=TRUE
SQLITE_USES=	sqlite
SQLITE_CMAKE_OFF=	-DBUILD_PLUGIN_SQLITE:BOOL=FALSE

PYTHON_DESC=	Enable Python plugin
PYTHON_CMAKE_ON=	-DBUILD_PLUGIN_PYTHON:BOOL=TRUE
PYTHON_USES=	python
PYTHON_BUILD_DEPENDS=	${PYNUMPY}
PYTHON_RUN_DEPENDS=	${PYNUMPY}
PYTHON_CMAKE_OFF=	-DBUILD_PLUGIN_PYTHON:BOOL=FALSE

TESTS_DESC=	Enable Tests
TESTS_CMAKE_ON=	-DBUILD_PLUGIN_TESTS:BOOL=TRUE
TESTS_CMAKE_OFF=	DBUILD_PLUGIN_TESTS:BOOL=FALSE

ATTRIBUTE_DESC=	Enable attribute plugin
ATTRIBUTE_CMAKE_ON=	-DBUILD_PLUGIN_ATTRIBUTE:BOOL=TRUE
ATTRIBUTE_CMAKE_OFF=	-DBUILD_PLUGIN_ATTRIBUTE:BOOL=FALSE

ICEBRIDGE_DESC=	Enable Icebridge plugin
ICEBRIDGE_LIB_DEPENDS=	libhdf5.so:science/hdf5
ICEBRIDGE_CMAKE_ON=	-DBUILD_PLUGIN_ICEBRIDGE:BOOL=TRUE
ICEBRIDGE_CMAKE_OFF=	-DBUILD_PLUGIN_ICEBRIDGE:BOOL=FALSE

APPS_DESC=	PDAL command line application
APPS_CMAKE_ON=	-DWITH_APPS:BOOL=TRUE
APPS_CMAKE_OFF=	-DWITH_APPS:BOOL=FALSE

BASH_DESC=	BASH completion
BASH_CMAKE_ON=	-DWITH_BASH:BOOL=TRUE
BASH_RUN_DEPENDS=	bash:shells/bash
BASH_CMAKE_OFF=	-DWITH_BASH:BOOL=FALSE

LASZIP_DESC=	Enable LASZip support (Recommended)
LASZIP_LIB_DEPENDS=	liblaszip.so:archivers/laszip

GEOTIFF_CMAKE_ON=	-DWITH_GEOTIFF:BOOL=TRUE
GEOTIFF_LIB_DEPENDS=	libgeotiff.so:graphics/libgeotiff
GEOTIFF_CMAKE_OFF=	-DWITH_GEOTIFF:BOOL=FALSE

LIBXML2_CMAKE_ON=	-DWITH_LIBXML2:BOOL=TRUE
LIBXML2_LIB_DEPENDS=	libxml2.so:textproc/libxml2
LIBXML2_CMAKE_OFF=	-DWITH_LIBXML2:BOOL=FALSE

.include <bsd.port.mk>
