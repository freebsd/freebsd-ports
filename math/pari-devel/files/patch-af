
$FreeBSD$

--- config/Makefile.SH.orig
+++ config/Makefile.SH
@@ -176,7 +176,7 @@
 CC_FLAVOR  =
 CC         = $CC \$(CC_FLAVOR)
 CPPFLAGS   = $CPPFLAGS
-CFLAGS     = $CFLAGS
+CFLAGS     = $CFLAGS -fPIC
 DLCFLAGS   = $DLCFLAGS
 LD_FLAVOR  = \$(CC_FLAVOR)
 LD         = $LD \$(LD_FLAVOR)
@@ -238,9 +238,12 @@
 INCLUDEDIR= \$(DESTDIR)$includedir
 LIBDIR    = \$(DESTDIR)$libdir
 BINDIR    = \$(DESTDIR)$bindir
-MANDIR    = \$(DESTDIR)$mandir
+MANDIR    = \$(DESTDIR)\${PREFIX}/man/man1
 EMACSDIR  = \$(DESTDIR)$emacsdir
-DATADIR   = \$(DESTDIR)$datadir
+#DATADIR   = \$(DESTDIR)$datadir
+ALLDIR    =\${PREFIX}/share/doc/pari
+READMEDIR = \$(ALLDIR)
+DATADIR   = \$(ALLDIR)
 SYSDATADIR= \$(DESTDIR)$sysdatadir
 
 EXDIR     = \$(DATADIR)/examples
@@ -392,7 +395,7 @@
 	-\$(RM) \$(MANDIR)/pari.1
 	-\$(LN) gp.1 \$(MANDIR)/pari.1
 
-install-misc: $install_emacs_files
+install-misc: $install_emacs_files install-top
 	-mkdir -p \$(MISCDIR) \$(BINDIR)
 	\$(INSTALL_PROGRAM) $misc/tex2mail \$(BINDIR)
 	\$(INSTALL_DATA) $doc/tex2mail.1 \$(MANDIR)
@@ -405,6 +408,19 @@
 	\$(INSTALL_DATA) $misc/pari.xpm  \$(MISCDIR)
 	\$(INSTALL_PROGRAM) $misc/xgp    \$(MISCDIR)
 
+install-top::
+	-mkdir -p \$(READMEDIR)
+	\$(INSTALL_DATA) $TOP/AUTHORS      \$(READMEDIR)
+	\$(INSTALL_DATA) $TOP/Announce.2.1 \$(READMEDIR)
+	\$(INSTALL_DATA) $TOP/CHANGES      \$(READMEDIR)
+	\$(INSTALL_DATA) $TOP/COMPAT       \$(READMEDIR)
+	\$(INSTALL_DATA) $TOP/COPYING      \$(READMEDIR)
+	\$(INSTALL_DATA) $TOP/CVS.txt      \$(READMEDIR)
+	\$(INSTALL_DATA) $TOP/MACHINES     \$(READMEDIR)
+	\$(INSTALL_DATA) $TOP/NEW          \$(READMEDIR)
+	\$(INSTALL_DATA) $TOP/README       \$(READMEDIR)
+	\$(INSTALL_DATA) $TOP/TODO         \$(READMEDIR)
+
 install-cfg::
 	-mkdir -p \$(SYSDATADIR) \$(DATADIR)/PARI
 	\$(INSTALL_DATA) $desc/pari.desc   \$(DATADIR)
@@ -413,7 +429,7 @@
 
 install-doc::
 	-mkdir -p \$(BINDIR) \$(DOCDIR)
-	-cd $doc; \$(MAKE) all
+#	-cd $doc; \$(MAKE) all
 	-\$(INSTALL_PROGRAM) $doc/gphelp    \$(BINDIR)
 	-\$(INSTALL_DATA) $doc/Makefile     \$(DOCDIR)
 	-\$(INSTALL_DATA) $doc/translations \$(DOCDIR)
@@ -431,11 +447,11 @@
 	-\$(INSTALL_DATA) $doc/usersch4.tex \$(DOCDIR)
 	-\$(INSTALL_DATA) $doc/usersch5.tex \$(DOCDIR)
 	-\$(INSTALL_DATA) $doc/paricfg.tex  \$(DOCDIR)
-	-\$(INSTALL_DATA) $doc/libpari.dvi    \$(DOCDIR)
-	-\$(INSTALL_DATA) $doc/users.dvi    \$(DOCDIR)
-	-\$(INSTALL_DATA) $doc/tutorial.dvi \$(DOCDIR)
-	-\$(INSTALL_DATA) $doc/refcard.dvi  \$(DOCDIR)
-	-\$(INSTALL_DATA) $doc/refcard.ps   \$(DOCDIR)
+#	-\$(INSTALL_DATA) $doc/libpari.dvi    \$(DOCDIR)
+#	-\$(INSTALL_DATA) $doc/users.dvi    \$(DOCDIR)
+#	-\$(INSTALL_DATA) $doc/tutorial.dvi \$(DOCDIR)
+#	-\$(INSTALL_DATA) $doc/refcard.dvi  \$(DOCDIR)
+#	-\$(INSTALL_DATA) $doc/refcard.ps   \$(DOCDIR)
 
 install-examples:
 	-mkdir -p \$(EXDIR)
@@ -532,15 +548,16 @@
 
 if test -n "$emacs"; then
   cat >> $file << EOT
-elc:
-	@echo "Byte-Compiling elisp files..."
-	-cd $emx; $emacs -batch \
-	   --eval '(setq load-path (append (list ".") load-path))' \
-	   -f batch-byte-compile *.el
+#elc:
+#	@echo "Byte-Compiling elisp files..."
+#	-cd $emx; $emacs -batch \
+#	   --eval '(setq load-path (append (list ".") load-path))' \
+#	   -f batch-byte-compile *.el
 
-$install_emacs_files: elc
+$install_emacs_files: #elc
 	-mkdir -p \$(EMACSDIR)
-	-cd $emx; for f in *.elc *.el pariemacs.txt; do \
+#	-cd $emx; for f in *.elc *.el pariemacs.txt; do \
+	-cd $emx; for f in *.el pariemacs.txt; do \
 	  \$(INSTALL_DATA) \$\$f \$(EMACSDIR); \
 	done
 EOT
