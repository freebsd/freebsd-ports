PORTNAME=	nlopt
DISTVERSIONPREFIX=	v
DISTVERSION=	2.7.1
PORTREVISION=	3
CATEGORIES=	math

MAINTAINER=	rhurlin@FreeBSD.org
COMMENT=	Nonlinear optimization library
WWW=		https://nlopt.readthedocs.io/en/latest/

LICENSE=	LGPL21 MIT
LICENSE_COMB=	multi
LICENSE_FILE=	${WRKSRC}/COPYING

BROKEN_armv6=	fails to package: Unable to access file site-packages/_nlopt.a:No such file or directory
BROKEN_armv7=	fails to package: Unable to access file site-packages/_nlopt.a:No such file or directory

USES=		cmake:testing
USE_GITHUB=	yes
GH_ACCOUNT=	stevengj
USE_LDCONFIG=	yes

FLAVORS=	full minimal

.if ${FLAVOR:U} == minimal
PKGNAMESUFFIX=	-${FLAVOR}
CMAKE_OFF=	NLOPT_GUILE NLOPT_PYTHON NLOPT_SWIG
CONFLICTS_INSTALL=	${PORTNAME}
.else
USES+=		guile:2.2,alias localbase pkgconfig python
BUILD_DEPENDS=	swig:devel/swig ${PYNUMPY}
RUN_DEPENDS=	${PYNUMPY}
CONFLICTS_INSTALL=	${PORTNAME}-minimal
PLIST_FILES=	lib/guile/2.2/extensions/nlopt_guile.so \
		${PYTHON_SITELIBDIR}/_nlopt.so \
		${PYTHON_SITELIBDIR}/nlopt.py \
		${GUILE_SITE_DIR}/nlopt.scm
.endif

.include <bsd.port.mk>
