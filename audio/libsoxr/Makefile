# $FreeBSD$

PORTNAME=	libsoxr
PORTVERSION=	0.1.2.20160529
PORTREVISION=	5
CATEGORIES=	audio
MASTER_SITES=	LOCAL/riggs/soxr/

MAINTAINER=	riggs@FreeBSD.org
COMMENT=	High quality, one-dimensional sample-rate conversion library

LICENSE=	LGPL21+ FFTPAK
LICENSE_COMB=	multi
LICENSE_NAME_FFTPAK=	FFTPAK license
LICENSE_FILE=	${WRKSRC}/COPYING.LGPL
LICENSE_FILE_FFTPAK=	${FILESDIR}/FFTPAK_license.txt
LICENSE_PERMS_FFTPAK=	dist-mirror dist-sell pkg-mirror pkg-sell auto-accept

USES=		cmake pathfix pkgconfig tar:bz2

USE_LDCONFIG=	yes

PORTDOCS=	NEWS README

CMAKE_MAKE_ARGS+=	-DWITH_LSR_BINDINGS:BOOL=ON \
			-DBUILD_SHARED_LIBS:BOOL=ON

OPTIONS_SUB=	yes

OPTIONS_DEFINE=		DOCS EXAMPLES OPENMP
OPTIONS_DEFINE_amd64=	SIMD
OPTIONS_DEFINE_i386=	SIMD
SIMD_DESC=		Use processor-specific SIMD optimisations

OPTIONS_RADIO=		SIMD_DFT
OPTIONS_RADIO_SIMD_DFT=	AVFFT PFFFT
SIMD_DFT_DESC=		Choice of SIMD DFT library

OPENMP_CMAKE_ON=	-DWITH_OPENMP:BOOL=ON
OPENMP_CMAKE_OFF=	-DWITH_OPENMP:BOOL=OFF
OPENMP_USES=		compiler:openmp

SIMD_CMAKE_OFF=		-DWITH_CR32S:BOOL=OFF \
			-DWITH_CR64S:BOOL=OFF

AVFFT_DESC=		Use external libavcodec
PFFFT_DESC=		Use internal PFFFT
AVFFT_CMAKE_ON=		-DWITH_AVFFT:BOOL=ON
AVFFT_CMAKE_OFF=	-DWITH_AVFFT:BOOL=OFF
AVFFT_IMPLIES=		SIMD
AVFFT_LIB_DEPENDS=	libavcodec.so:multimedia/ffmpeg
PFFFT_CMAKE_ON=		-DWITH_PFFFT:BOOL=ON
PFFFT_CMAKE_OFF=	-DWITH_PFFFT:BOOL=OFF
PFFFT_IMPLIES=		SIMD

post-patch:
	@${GREP} -El 'SOURCE_DIR}/LICENCE|AVCODEC_INCLUDE_DIRS' \
		${WRKSRC}/CMakeLists.txt | ${XARGS} ${REINPLACE_CMD} \
		-e '/$${CMAKE_CURRENT_SOURCE_DIR}\/LICENCE/d' \
		-e 's/AVCODEC_INCLUDE_DIRS/AVCODEC_INCLUDES/'

.include <bsd.port.mk>
