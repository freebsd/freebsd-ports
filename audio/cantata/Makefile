# $FreeBSD$

PORTNAME=		cantata
PORTVERSION=		2.0.1
DISTVERSIONPREFIX=	v
CATEGORIES=		audio kde

MAINTAINER=		kde@FreeBSD.org
COMMENT=		Graphical client for MPD using Qt5

LICENSE=		GPLv3
LICENSE_FILE=		${WRKSRC}/LICENSE

USE_GITHUB=		yes
GH_ACCOUNT=		CDrummond

USE_QT5=		buildtools_build concurrent core dbus gui network \
			qmake_build sql sql-sqlite3_run svg widgets xml

CMAKE_ARGS=		-DENABLE_QT5:BOOL=TRUE	\
			-DENABLE_KDE:BOOL=FALSE

USES=			cmake:outsource cpe pkgconfig shebangfix tar:bzip2
SHEBANG_FILES=		dynamic/cantata-dynamic cantata-remote.cmake
CPE_VENDOR=		craig_drummond
USE_LDCONFIG=		yes

OPTIONS_DEFINE=		CDPARANOIA MTP NLS PROXY TAGLIB
OPTIONS_GROUP=		CDINFO REPLAYGAIN
OPTIONS_GROUP_CDINFO=	CDDB MUSICBRAINZ
OPTIONS_GROUP_REPLAYGAIN=	FFMPEG MPG123
OPTIONS_RADIO=		HSP
OPTIONS_RADIO_HSP=	QT5 VLC
OPTIONS_DEFAULT=	CDDB CDPARANOIA FFMPEG MPG123 MTP MUSICBRAINZ TAGLIB VLC
OPTIONS_SUB=		yes

CDDB_DESC=		CD info retrieval via CDDB
CDINFO_DESC=		AudioCD support
FFMPEG_DESC=		ReplayGain calculation support via FFmpeg
HSP_DESC=		MPD HTTP stream playback
MPG123_DESC=		ReplayGain calculation support via mpg123
MUSICBRAINZ_DESC=	CD info retrieval via MusicBrainz
PROXY_DESC=		Proxy configuration in settings dialog
QT5_DESC=		HTTP streams support via QtMultimedia
REPLAYGAIN_DESC=	Replaygain calculation support
TAGLIB_DESC=		Reading and editing Meta-Data of audio files
VLC_DESC=		HTTP streams support via libVLC

CDDB_IMPLIES=		CDPARANOIA
CDDB_LIB_DEPENDS=	libcddb.so:audio/libcddb
CDDB_CMAKE_ON=		-DENABLE_CDDB:BOOL=TRUE
CDDB_CMAKE_OFF=		-DENABLE_CDDB:BOOL=FALSE

CDPARANOIA_IMPLIES=	TAGLIB
CDPARANOIA_LIB_DEPENDS=	libcdda_interface.so:audio/cdparanoia
CDPARANOIA_CMAKE_ON=	-DENABLE_CDPARANOIA:BOOL=TRUE
CDPARANOIA_CMAKE_OFF=	-DENABLE_CDPARANOIA:BOOL=FALSE

FFMPEG_IMPLIES=		TAGLIB
FFMPEG_LIB_DEPENDS=	libavcodec.so:multimedia/ffmpeg
FFMPEG_CMAKE_ON=	-DENABLE_FFMPEG:BOOL=TRUE
FFMPEG_CMAKE_OFF=	-DENABLE_FFMPEG:BOOL=FALSE

MPG123_IMPLIES=		TAGLIB
MPG123_LIB_DEPENDS=	libmpg123.so:audio/mpg123
MPG123_CMAKE_ON=	-DENABLE_MPG123:BOOL=TRUE
MPG123_CMAKE_OFF=	-DENABLE_MPG123:BOOL=FALSE

MTP_LIB_DEPENDS=	libmtp.so:multimedia/libmtp
MTP_CMAKE_ON=		-DENABLE_MTP:BOOL=TRUE
MTP_CMAKE_OFF=		-DENABLE_MTP:BOOL=FALSE

MUSICBRAINZ_IMPLIES=	CDPARANOIA
MUSICBRAINZ_LIB_DEPENDS=libmusicbrainz5.so:audio/libmusicbrainz5
MUSICBRAINZ_CMAKE_ON=	-DENABLE_MUSICBRAINZ:BOOL=TRUE
MUSICBRAINZ_CMAKE_OFF=	-DENABLE_MUSICBRAINZ:BOOL=FALSE

NLS_USE=		QT5=linguisttools_build
NLS_CMAKE_ON=		-DLCONVERT_EXECUTABLE:STRING=${QT_BINDIR}/lconvert \
			-DLRELEASE_EXECUTABLE:STRING=${QT_BINDIR}/lrelease
NLS_CMAKE_OFF=		-DLCONVERT_EXECUTABLE:BOOL=FALSE \
			-DLRELEASE_EXECUTABLE:BOOL=FALSE

PROXY_CMAKE_ON=		-DENABLE_PROXY_CONFIG:BOOL=TRUE
PROXY_CMAKE_OFF=	-DENABLE_PROXY_CONFIG:BOOL=FALSE

QT5_USE=		QT5=multimedia

TAGLIB_LIB_DEPENDS=	libtag.so:audio/taglib \
			libtag-extras.so:audio/taglib-extras
TAGLIB_USES=		localbase
TAGLIB_CMAKE_ON=	-DENABLE_TAGLIB_EXTRAS:BOOL=TRUE \
			-DENABLE_TAGLIB:BOOL=TRUE
TAGLIB_CMAKE_OFF=	-DENABLE_TAGLIB_EXTRAS:BOOL=FALSE \
			-DENABLE_TAGLIB:BOOL=FALSE

VLC_LIB_DEPENDS=	libvlc.so:multimedia/vlc
VLC_CMAKE_ON=		-DENABLE_LIBVLC:BOOL=TRUE
VLC_CMAKE_OFF=		-DENABLE_LIBVLC:BOOL=FALSE

.include <bsd.port.options.mk>

.if ${PORT_OPTIONS:MFFMPEG} || ${PORT_OPTIONS:MMPG123}
LIB_DEPENDS+=		libebur128.so:audio/libebur128
PLIST_SUB+=		REPLAYGAIN=""
.else
PLIST_SUB+=		REPLAYGAIN="@comment "
.endif

.if ${PORT_OPTIONS:MQT5} || ${PORT_OPTIONS:MVLC}
CMAKE_ARGS+=		-DENABLE_HTTP_STREAM_PLAYBACK:BOOL=TRUE
.else
CMAKE_ARGS+=		-DENABLE_HTTP_STREAM_PLAYBACK:BOOL=FALSE
.endif

.include <bsd.port.mk>
