# Created by: trevor
# $FreeBSD$

PORTNAME=	mbrolavox
PORTVERSION=	3.0.1
PORTREVISION=	1
CATEGORIES=	audio accessibility
DISTFILES=	#
DIST_SUBDIR=	${PORTNAME}

MAINTAINER=	ports@FreeBSD.org
COMMENT=	Voices for MBROLA voice synthesizer

USES=		zip:infozip
NO_BUILD=	yes
RESTRICTED=	No commercial nor military use, no sale
WRKSRC=		${WRKDIR}/voices
PORTDATA=	*

VOICESCONF=	${.CURDIR}/voices.conf

.include "Makefile.options"

.include <bsd.port.options.mk>

.for ii in ${PORT_OPTIONS}
.   if defined(FILE_${ii})
MASTER_SITES+=	http://www.tcts.fpms.ac.be/synthesis/mbrola/dba/${ii}/:${ii} \
		http://www.festvox.org/mbrola/dba/${ii}/:${ii} \
		http://mambo.ucsc.edu/psl/mbrola/dba/${ii}/:${ii}
DISTFILES+=	${FILE_${ii}}:${ii}
FILEDIRS+=	${ii}
MYFILES+=	${FILE_${ii}}
.   endif
.endfor

.if empty(DISTFILES)
IGNORE=	requires that at least one OPTION is selected
.endif

do-extract:
	@${MKDIR} ${WRKSRC}
.for ii in ${MYFILES}
	@${UNZIP_CMD} -qo ${DISTDIR}/${DIST_SUBDIR}/${ii} -d ${WRKSRC}
.endfor

do-install:
	@cd ${WRKSRC} && ${COPYTREE_SHARE} . ${STAGEDIR}${DATADIR}

# Generates OPTIONS file from voices.conf -- really for maintainer use
# Only included for compatibility with anyone who wants to modify voices.conf

Makefile.options: ${.TARGET}.unsorted
	${ECHO_CMD} '# $$Free''BSD$$' > ${.TARGET}
	${ECHO_CMD} "# Autogenerated from ${VOICESCONF} using make ${.TARGET}" \
		>> ${.TARGET}
	${SORT} ${.ALLSRC} >> ${.TARGET}

Makefile.options.unsorted: ${VOICESCONF}
	: > ${.TARGET}
	IFS='|'; while read opt file define default; do \
		optdefine="$$optdefine $$opt"; \
		${ECHO_CMD} "$${opt}_DESC=	$$define" >> ${.TARGET}; \
		${ECHO_CMD} "FILE_$${opt}=	$$file" >> ${.TARGET}; \
		case $$default in \
		[Oo][Nn]) optdefault="$$optdefault $$opt" ;; \
		*) ;; \
		esac; \
	done < ${.ALLSRC}; \
	${ECHO_CMD} $$optdefine | /usr/bin/fold -sw 50 | \
		${SED} 's,^[[:space:]]*,OPTIONS_DEFINE+=	,;s,[[:space:]]*$$,,' >> ${.TARGET}; \
	[ -z "$$optdefault" ] || \
		${ECHO_CMD} $$optdefault | /usr/bin/fold -sw 50 | \
		${SED} 's,^[[:space:]]*,OPTIONS_DEFAULT+=	,' >> ${.TARGET}

.include <bsd.port.mk>
