# Created by: Shane Ambler <FreeBSD@ShaneWare.Biz>
# $FreeBSD$

PORTNAME=	hydrogen
PORTVERSION=	0.9.7a
CATEGORIES=	audio
PKGNAMESUFFIX=	-devel

MAINTAINER=	FreeBSD@ShaneWare.Biz
COMMENT=	Advanced drum machine

LICENSE=	GPLv2

LIB_DEPENDS=	libsndfile.so:audio/libsndfile

CONFLICTS=	hydrogen-0.*

USE_GITHUB=	yes
GH_ACCOUNT=	hydrogen-music
GH_TAGNAME=    718b2652fb

USE_QT4=	qmake_build moc_build rcc_build uic_build gui \
		network xml xmlpatterns
USES=		cmake desktop-file-utils pkgconfig

OPTIONS_SINGLE=		EXPORT
OPTIONS_SINGLE_EXPORT=	LIBARCHIVE LIBTAR
OPTIONS_DEFINE=		ALSA DEBUG JACK LADSPA LASH OSS PORTAUDIO \
			PULSEAUDIO RDF RUBBERBAND TEST
OPTIONS_DEFAULT=	JACK LADSPA LIBTAR OSS RDF

EXPORT_DESC=		Export support for drumkit

ALSA_CMAKE_ON=		-DWANT_ALSA:BOOL=ON
ALSA_CMAKE_OFF=		-DWANT_ALSA:BOOL=OFF
ALSA_LIB_DEPENDS=	libasound.so:audio/alsa-lib
ALSA_RUN_DEPENDS=	alsa-plugins>=0:audio/alsa-plugins

DEBUG_CMAKE_ON=		-DWANT_DEBUG:BOOL=ON
DEBUG_CMAKE_OFF=	-DWANT_DEBUG:BOOL=OFF

JACK_CMAKE_ON=		-DWANT_JACK:BOOL=ON -DWANT_JACKSESSION:BOOL=ON
JACK_CMAKE_OFF=		-DWANT_JACK:BOOL=OFF -DWANT_JACKSESSION:BOOL=OFF
JACK_LIB_DEPENDS=	libjack.so:audio/jack

LADSPA_CMAKE_ON=	-DWANT_LADSPA:BOOL=ON \
			-DLADSPA_LIBRARIES:STRING=${LOCALBASE}/lib/ladspa
LADSPA_CMAKE_OFF=	-DWANT_LADSPA:BOOL=OFF
LADSPA_BUILD_DEPENDS=	ladspa>=0:audio/ladspa
LADSPA_RUN_DEPENDS=	analyseplugin:audio/ladspa

LASH_CMAKE_ON=		-DWANT_LASH:BOOL=ON
LASH_CMAKE_OFF=		-DWANT_LASH:BOOL=OFF
LASH_LIB_DEPENDS=	liblash.so:audio/lash

LIBARCHIVE_DESC=	LibArchive support
LIBARCHIVE_CMAKE_ON=	-DWANT_LIBARCHIVE:BOOL=ON
LIBARCHIVE_CMAKE_OFF=	-DWANT_LIBARCHIVE:BOOL=OFF
LIBARCHIVE_USES=	libarchive

LIBTAR_DESC=		Libtar support
LIBTAR_CMAKE_ON=	-DWANT_LIBTAR:BOOL=ON \
			-DCMAKE_REQUIRED_INCLUDES:STRING=${LOCALBASE}/include/
LIBTAR_CMAKE_OFF=	-DWANT_LIBTAR:BOOL=OFF
LIBTAR_LIB_DEPENDS=	libtar.so:devel/libtar

OSS_CMAKE_ON=		-DWANT_OSS:BOOL=ON
OSS_CMAKE_OFF=		-DWANT_OSS:BOOL=OFF

PORTAUDIO_CMAKE_ON=	-DWANT_PORTAUDIO:BOOL=ON
PORTAUDIO_CMAKE_OFF=	-DWANT_PORTAUDIO:BOOL=OFF
PORTAUDIO_LIB_DEPENDS=	libportaudio.so:audio/portaudio

PULSEAUDIO_CMAKE_ON=	-DWANT_PULSEAUDIO:BOOL=ON
PULSEAUDIO_CMAKE_OFF=	-DWANT_PULSEAUDIO:BOOL=OFF
PULSEAUDIO_LIB_DEPENDS=	libpulse.so:audio/pulseaudio

RDF_DESC=		RDF File support
RDF_CMAKE_ON=		-DWANT_LRDF:BOOL=ON \
			-DLRDF_INCLUDE_DIR:STRING=${LOCALBASE}/include/raptor2
RDF_CMAKE_OFF=		-DWANT_LRDF:BOOL=OFF
RDF_LIB_DEPENDS=	liblrdf.so:textproc/liblrdf

# using librubberband is experimental and current versions have bad timing
# installing the rubberband cli tool still works as before
RUBBERBAND_DESC=	librubberband for time stretching
RUBBERBAND_CMAKE_ON=	-DWANT_RUBBERBAND:BOOL=ON \
			-DRUBBERBAND_INCLUDE_DIR:STRING=${LOCALBASE}/include/rubberband
RUBBERBAND_CMAKE_OFF=	-DWANT_RUBBERBAND:BOOL=OFF
RUBBERBAND_LIB_DEPENDS=	librubberband.so:audio/rubberband

TEST_CMAKE_ON=		-DWANT_CPPUNIT:BOOL=ON
TEST_CMAKE_OFF=		-DWANT_CPPUNIT:BOOL=OFF
TEST_BUILD_DEPENDS=	${LOCALBASE}/libdata/pkgconfig/cppunit.pc:devel/cppunit

post-patch:
	@${REINPLACE_CMD} 's|EXISTS(tar|EXISTS(${LOCALBASE}/lib/libtar.so|g' \
		${WRKSRC}/CMakeLists.txt

test: build
	cd ${WRKSRC} && ./src/tests/tests

.include <bsd.port.mk>
