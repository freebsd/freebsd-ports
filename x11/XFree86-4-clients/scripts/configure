#!/bin/sh

# This script does the following:
# (1) cp xf86site.def, installed by imake-4 port,
#       to ${WRKDIR}/xc/config/cf.
#     this provides settings for the ports system.
# (2) Create a host.def for this specific port, using 
#     host.def as a base.

ORIGDEF=$PREFIX/lib/X11/config/xf86site.def
DESTDEF=$WRKDIR/xc/config/cf/xf86site.def
ORIGHOSTDEF=$PREFIX/lib/X11/config/host.def
LOCALDEF=$WRKDIR/.config
HOSTDEF=$WRKDIR/xc/config/cf/host.def

# Use original host.def as initial config file
rm -f $LOCALDEF
grep -v '#define.*ProjectRoot' $ORIGHOSTDEF	>> $LOCALDEF
echo "#define ProjectRoot $PREFIX"		>> $LOCALDEF

# This is also defined in xf86site.def, but doesn't get
# picked up for some reason.
echo "#define NothingOutsideProjectRoot YES"	>> $LOCALDEF

# User Config.
if [ X$InstallXdmConfig != XDEFAULT -a X$InstallXdmConfig != X ]; then
echo "#define InstallXdmConfig $InstallXdmConfig" >> $LOCALDEF
fi
if [ X$InstallXinitConfig != XDEFAULT -a X$InstallXinitConfig != X ]; then
echo "#define InstallXinitConfig $InstallXinitConfig" >> $LOCALDEF
fi
if [ X$InstallAppDefFiles != XDEFAULT -a X$InstallAppDefFiles != X ]; then
echo "#define InstallAppDefFiles $InstallAppDefFiles" >> $LOCALDEF
fi

# disable some options
for i in \
	InstallFSConfig \
	BuildServer \
	BuildFontServer \
	BuildFonts \
	Build75DpiFonts \
	Build100DpiFonts \
	BuildSpeedoFonts \
	BuildType1Fonts \
	BuildCIDFonts \
	BuildCyrillicFonts \
	BuildLatin2Fonts \
	BuildPlugin \
	BuildHtmlManPages \
	LibHeaders \
	LibInstall \
	ForceNormalLib \
	ModInstall \
	XTrueTypeInstallCConvHeaders
do \
	echo "#define $i NO"			>> $LOCALDEF
done

echo "#define FreeBSDCC	${CC}"			>> $LOCALDEF
echo "#define FreeBSDCXX ${CXX}"		>> $LOCALDEF
echo "#define FreeBSDCFLAGS ${CFLAGS}"		>> $LOCALDEF

echo "#define FontLibSharedFreeType  YES"	>> $LOCALDEF
echo "#define LibInstallBuild  YES"		>> $LOCALDEF
echo "#define FreeBSDBuildXlib NO"		>> $LOCALDEF
echo "#define FreeBSDBuildXbin YES"		>> $LOCALDEF
echo "#define StandardIncludes -I$PREFIX/include" >> $LOCALDEF
echo "#define DontUseLibPathVar YES"		>> $LOCALDEF
echo "#define PreloadSetup"			>> $LOCALDEF
echo "#define UseInstalledPrograms YES"		>> $LOCALDEF
echo "#define UseInstalledLibraries YES"	>> $LOCALDEF

# Copy ORIGDEF to DESTDEF
rm -f $DESTDEF
cp -f $ORIGDEF $DESTDEF

# copy generated config to host.def
cp -f $LOCALDEF $HOSTDEF

exit 0
