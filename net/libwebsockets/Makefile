# Created by: Iblis Lin <iblis@hs.ntnu.edu.tw>
# $FreeBSD$

PORTNAME=	libwebsockets
PORTVERSION=	2.1.0
DISTVERSIONPREFIX=	v
CATEGORIES=	net devel
MASTER_SITES=	GITHUB

MAINTAINER=	iblis@hs.ntnu.edu.tw
COMMENT=	C library for lightweight websocket clients and servers

LICENSE=	LGPL21
LICENSE_FILE=	${WRKSRC}/LICENSE

USE_GITHUB=	yes
GH_ACCOUNT=	warmcat

PORTSCOUT=	limit:^v\d+\.*

USES=		cmake pkgconfig ssl
USE_LDCONFIG=	yes

CMAKE_ARGS=	-DLWS_WITHOUT_TESTAPPS=ON \
		-DLWS_WITHOUT_TEST_SERVER=ON \
		-DLWS_WITHOUT_TEST_SERVER_EXTPOLL=ON \
		-DLWS_WITHOUT_TEST_PING=ON \
		-DLWS_WITHOUT_TEST_ECHO=ON \
		-DLWS_WITHOUT_TEST_CLIENT=ON \
		-DLWS_WITHOUT_TEST_FRAGGLE=ON

OPTIONS_DEFINE=	HTTP2 HTTP_PROXY IPV6 LIBEV LIBUV UNIX_SOCK WEBSERVER PLUGINS
OPTIONS_SUB=	yes

HTTP_PROXY_DESC=	HTTP proxy support
LIBUV_DESC=	Asynchronous I/O support via libuv
UNIX_SOCK_DESC=	Unix domain socket support

HTTP2_CMAKE_ON=	-DLWS_WITH_HTTP2=ON

HTTP_PROXY_CMAKE_ON=	-DLWS_WITH_HTTP_PROXY=ON -DLIBHUBBUB_LIBRARIES=${PREFIX}/lib/libhubbub.so
HTTP_PROXY_LIB_DEPENDS=	libhubbub.so:www/libhubbub

IPV6_CMAKE_ON=	-DLWS_IPV6=ON

LIBEV_CMAKE_ON=	-DLWS_WITH_LIBEV=ON
LIBEV_LIB_DEPENDS=	libev.so:devel/libev

LIBUV_CMAKE_ON=	-DLWS_WITH_LIBUV=ON
LIBUV_LIB_DEPENDS=	libuv.so:devel/libuv

UNIX_SOCK_CMAKE_ON=	-DLWS_UNIX_SOCK=ON

WEBSERVER_CMAKE_ON=	-DLWS_WITH_LWSWS=ON
WEBSERVER_LIB_DEPENDS=	libuv.so:devel/libuv

PLUGINS_CMAKE_ON=	-DLWS_WITH_PLUGINS=ON \
			-DLWS_WITH_SERVER_STATUS=ON \
			-DLWS_WITH_GENERIC_SESSIONS=ON
PLUGINS_LIB_DEPENDS=	libsqlite3.so:databases/sqlite3

.include <bsd.port.mk>
