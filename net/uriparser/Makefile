# Created by: Ed Schouten <ed@FreeBSD.org>

PORTNAME=	uriparser
DISTVERSION=	0.9.6
CATEGORIES=	net
MASTER_SITES=	https://github.com/${PORTNAME}/${PORTNAME}/releases/download/${PORTNAME}-${PORTVERSION}/
DISTFILES=	${DISTNAME}${EXTRACT_SUFX}
EXTRACT_ONLY=	${DISTNAME}${EXTRACT_SUFX}

MAINTAINER=	svysh.fbsd@gmail.com
COMMENT=	URI parsing library

LICENSE=	BSD3CLAUSE
LICENSE_FILE=	${WRKSRC}/COPYING

BUILD_DEPENDS=	bash:shells/bash

USES=		cmake:noninja cpe pathfix tar:xz
CPE_VENDOR=	uriparser_project
USE_LDCONFIG=	yes

CMAKE_OFF=	URIPARSER_BUILD_DOCS # will fetch prebuilds from the upstream, if DOCS is selected

TEST_TARGET=	test

PLIST_SUB=	DISTVERSION=${DISTVERSION}
PORTDOCS=	*

OPTIONS_DEFINE=		DOCS TEST
DOCS_DISTFILES=		${_DISTDOCSFILE} \
			${DISTNAME}.qch
DOCS_EXTRACT_ONLY=	${_DISTDOCSFILE}
TEST_BUILD_DEPENDS=	googletest>=1.10.0:devel/googletest
TEST_CMAKE_BOOL=	URIPARSER_BUILD_TESTS

_DISTDOCSFILE=	${_DISTDOCSNAME}.zip
_DISTDOCSNAME=	${DISTNAME}-doc

post-install-DOCS-on:
	${MKDIR} ${STAGEDIR}${DOCSDIR}/qch
	cd ${WRKSRC}/doc && ${COPYTREE_SHARE} . ${STAGEDIR}${DOCSDIR}
	cd ${WRKSRC}/../${_DISTDOCSNAME} && ${COPYTREE_SHARE} . ${STAGEDIR}${DOCSDIR}
	${INSTALL_MAN} ${DISTDIR}/${DISTNAME}.qch ${STAGEDIR}${DOCSDIR}/qch
	( ${ECHO} "QCH file is a QT Compressed Help file, generated by doxygen, cf:"; \
	${ECHO} "https://doc.qt.io/qt-5/assistant-details.html"; ) > ${STAGEDIR}${DOCSDIR}/qch/readme-qch

.include <bsd.port.mk>
