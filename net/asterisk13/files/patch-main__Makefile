--- main/Makefile.orig	2017-10-13 17:46:56 UTC
+++ main/Makefile
@@ -75,9 +75,12 @@ endif
 
 ifeq ($(OSARCH),FreeBSD)
   # -V is understood by BSD Make, not by GNU make.
-  BSDVERSION=$(shell make -V OSVERSION -f /usr/share/mk/bsd.port.subdir.mk)
+  BSDVERSION=$(OSVERSION)
+  BSDVERSION?=$(shell make -V OSVERSION -f /usr/share/mk/bsd.port.subdir.mk)
   AST_LIBS+=$(shell if test $(BSDVERSION) -lt 502102 ; then echo "-lc_r"; else echo "-pthread"; fi)
+  CRYPT_LIB=$(shell if test $(BSDVERSION) -ge 1200001 ; then echo "-lcrypt"; fi)
   AST_LIBS+=-lcrypto
+  AST_LIBS+=%%LIBSYSINFO%%
 endif
 
 ifneq ($(findstring $(OSARCH), mingw32 cygwin ),)
