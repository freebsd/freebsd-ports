--- ../tcl/unix/Makefile.in.orig	Sun Feb  6 18:53:59 2000
+++ ../tcl/unix/Makefile.in	Thu Jul 13 15:35:23 2000
@@ -131,7 +131,7 @@
 #
 all: binaries libraries doc
 
-binaries: tcl checkup RUNTIME tclXtest
+binaries: tcl checkup RUNTIME
 
 libraries: tcl.tndx tcl.tlib tclx.tcl buildidx.tcl
 
@@ -162,7 +162,8 @@
 	PATH=${TCL_UNIX_DIR}:${PATH}; export PATH; \
 	TCL_LIBRARY=${TCL_UNIX_DIR}/../library; export TCL_LIBRARY; \
 	LD_LIBRARY_PATH=${TCL_UNIX_DIR}:${LD_LIBRARY_PATH}; export LD_LIBRARY_PATH; \
-	${TCL_SHLIB_LD} -o ${TCLX_SHLIB_NAME} ${SOBJS} ${TCL_SHLIB_LD_LIBS}
+	${TCL_SHLIB_LD} -o ${TCLX_SHLIB_NAME} ${SOBJS} @NEED_TCL_STUB@ -lm
+	ln -sf ${TCLX_SHLIB_NAME} `echo ${TCLX_SHLIB_NAME} | sed 's/\.so.*$$/.so/'`
 
 hello:	hello.c
 	${CC} ${LD_SWITCHES} -o $@ hello.c ${STATIC_LIBS}
@@ -184,7 +185,7 @@
 # unless we don't have them.
 #
 RUNTIME: tcl.tlib tcl.tndx tclx.tcl buildidx.tcl autoload.tcl help.tmp \
-         dltest.tmp checkup
+         checkup
 
 tcl.tlib: ${TLIB_SRCS} autoload.tcl
 	-rm -f tcl.tlib tcl.tndx
@@ -308,5 +308,5 @@
 	mkdir ${HELP_DIR}
-	${BLDMANHELP} ${TCL_SRC_DIR}/doc ${TCLX_TOOLS_SRC_DIR}/tclmanpages \
+	${BLDMANHELP} ${TCLX_TOOLS_SRC_DIR}/tclmanpages \
 	    ${HELP_DIR} Tcl.brf
 	${RUNTCL} -c "buildhelp ${HELP_DIR} TclX.brf ${TCLX_DOC_DIR}/TclX.n"
 
@@ -338,9 +339,11 @@
 	    ${INSTCOPY} ${TCLX_STLIB_NAME} ${INSTALL_ROOT}${TCLX_INST_LIB}; \
 	    ${RANLIB} ${INSTALL_ROOT}${TCLX_INST_LIB}/${TCLX_STLIB_NAME}; \
 	fi
-	${INSTCOPY} tclxConfig.sh ${INSTALL_ROOT}${TCLX_INST_LIB}
+	${INSTCOPY} tclxConfig.sh ${INSTALL_ROOT}${TCLX_INST_RUNTIME}
 	if test "@SHARED_BUILD@" = "1"; then \
 	    ${INSTCOPY} ${TCLX_SHLIB_NAME} ${INSTALL_ROOT}${TCLX_INST_LIB} ;\
+	    (cd ${INSTALL_ROOT}${TCLX_INST_LIB} && \
+		ln -sf ${TCLX_SHLIB_NAME} `echo ${TCLX_SHLIB_NAME} | sed 's/\.so.*$$/.so/'`) ;\
 	    ${INSTCOPY} pkgIndex.tcl ${INSTALL_ROOT}${TCLX_EXEC_RUNTIME} ;\
 	fi
 
@@ -385,2 +388,2 @@
 tclXAppInit.o: ${TCLX_UNIX_SRC_DIR}/tclXAppInit.c
-	${CC} -c ${CC_SWITCHES} ${TCLX_UNIX_SRC_DIR}/tclXAppInit.c
+	${CC} -c ${CC_SWITCHES} -UUSE_TCL_STUBS ${TCLX_UNIX_SRC_DIR}/tclXAppInit.c
