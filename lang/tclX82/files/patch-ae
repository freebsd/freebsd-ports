--- configure	Sun Feb  6 18:54:02 2000
+++ configure	Thu Jul 13 14:29:54 2000
@@ -820,3 +820,5 @@
 
+if [ `uname -m` != sparc64 ]; then
 TCL_SHLIB_CFLAGS=`echo "$TCL_SHLIB_CFLAGS" |sed -e "s|-fPIC|-fpic|" -e "s|-PIC|-pic|" -e "s|-K PIC|-K pic|" -e "s|-KPIC|-Kpic|" -e "s|+Z|+z|"`
+fi
 
@@ -2088,8 +2088,11 @@
 	    ;;
 	FreeBSD-*)
 	    # FreeBSD 3.* and greater have ELF.
+	    SHARED_LIB_SUFFIX='${TCL_TRIM_DOTS}\$\{DBGX\}.so'
+	    UNSHARED_LIB_SUFFIX='${TCL_TRIM_DOTS}\$\{DBGX\}.a'
+	    TCL_LIB_VERSIONS_OK=nodots
-	    SHLIB_CFLAGS="-fPIC"
+	    SHLIB_CFLAGS="-fPIC -DPIC"
	    SHLIB_LD="ld -Bshareable -x"
 	    SHLIB_LD_LIBS=""
 	    SHLIB_SUFFIX=".so"
 	    DL_OBJS="tclLoadDl.o"
@@ -2496,15 +2499,13 @@
 
 DBGX=${TCLX_DBGX}
 VERSION=$TCLX_VERSION
-eval "TCLX_STLIB_NAME=libtclx${UNSHARED_LIB_SUFFIX}"
-eval "TCLX_SHLIB_NAME=libtclx${SHARED_LIB_SUFFIX}"
-eval "TCLX_SHLIB_NAME=${TCLX_SHLIB_NAME}"
+TCLX_STLIB_NAME=libtclx83.a
+TCLX_SHLIB_NAME=libtclx83.so.1
 
 DBGX=${TKX_DBGX}
 VERSION=$TKX_VERSION
-eval "TKX_STLIB_NAME=libtkx${UNSHARED_LIB_SUFFIX}"
-eval "TKX_SHLIB_NAME=libtkx${SHARED_LIB_SUFFIX}"
-eval "TKX_SHLIB_NAME=${TKX_SHLIB_NAME}"
+TKX_STLIB_NAME=libtkx83.a
+TKX_SHLIB_NAME=libtkx83.so.1
 
 #
 # Determine suffix to use for the object files for the shared library.
@@ -4793,2 +4794,8 @@
 EOF
+
+if /usr/bin/ldd ${prefix}/bin/tclsh$TCL_VERSION | fgrep -qv libtcl; then
+	TCL_EXTRA_CFLAGS=$TCL_EXTRA_CFLAGS\ -DUSE_TCL_STUBS
+	NEED_TCL_STUB=$TCL_STUB_LIB_SPEC
+fi
+
 cat >> $CONFIG_STATUS <<EOF
@@ -4831,6 +4832,8 @@
 s%@TCLX_FULL_VERSION@%$TCLX_FULL_VERSION%g
 s%@TKX_VERSION@%$TKX_VERSION%g
 s%@TKX_FULL_VERSION@%$TKX_FULL_VERSION%g
+s%@TCL_PREFIX@%$TCL_PREFIX%g
+s%@NEED_TCL_STUB@%$NEED_TCL_STUB%g
 s%@TCL_BIN_DIR@%$TCL_BIN_DIR%g
 s%@TCL_SRC_DIR@%$TCL_SRC_DIR%g
 s%@TCL_LIB_FILE@%$TCL_LIB_FILE%g
@@ -4851,6 +4853,7 @@
 s%@TCL_STUB_LIB_SPEC@%$TCL_STUB_LIB_SPEC%g
 s%@TCL_LIB_DIR@%$TCL_LIB_DIR%g
 s%@TCL_LIBRARY_DIR@%$TCL_LIBRARY_DIR%g
+s%@TK_PREFIX@%$TK_PREFIX%g
 s%@TK_BIN_DIR@%$TK_BIN_DIR%g
 s%@TK_SRC_DIR@%$TK_SRC_DIR%g
 s%@TK_LIB_FILE@%$TK_LIB_FILE%g
