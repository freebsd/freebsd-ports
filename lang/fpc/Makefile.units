PLIST_SUB=		PORTVERSION=${PORTVERSION} \
			BUILDNAME=${BUILDNAME}

PLIST=			${.CURDIR}/pkg-plist
PATCHDIR=		${.CURDIR}/files
WRKSRC=			${WRKDIR}/${PORTNAME}-${PORTVERSION}

UNITPREFIX=    		unit-
UNITEXTRACT_SUFX=	.tar.gz
UNITNAME=		${UNITPREFIX}${PKGNAMESUFFIX:S/-//}${BUILDNAME:S/^/./}${UNITEXTRACT_SUFX}
UNITDIR=		lib/fpc/${PORTVERSION}/units/${BUILDNAME}

EXTRACT_AFTER_ARGS=	| ${TAR} -xf - ${EXTRACTUNITDIR}
OPT=-CX

MAKE_ENV+=		PP=${LOCALBASE}/bin/ppc386 \
			FPCMAKE=${LOCALBASE}/bin/fpcmake \
			FPCTARGET=${BUILDNAME} \
			OPT="${OPT}" \
			BSDHIER=1

.if ${PKGNAMESUFFIX} == "-gdbint"
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-ibase"
.	if defined(WITH_IBASE)
USE_FIREBIRD=	yes
.	endif
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-mysql"
.	if defined(WITH_MYSQL)
USE_MYSQL=	yes
.	endif
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-odbc"
.	if defined(WITH_ODBC)
LIB_DEPENDS=	odbc.1:${PORTSDIR}/databases/unixODBC
.	endif
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-oracle"
.	if defined(WITH_ORACLE)
ORACLE8_LIB=	${LOCALBASE}/oracle8-client/rdbms/lib
RUN_DEPENDS=	${ORACLE8_LIB}/env_rdbms.mk:${PORTSDIR}/databases/oracle8-client
.	endif
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-postgres"
.	if defined(WITH_PGSQL)
USE_PGSQL=	yes
.	endif
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-pasjpeg"
HAVE_EXAMPLES=  true
.endif

.if ${PKGNAMESUFFIX} == "-paszlib"
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-regexpr"
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-sqlite"
.	if defined(WITH_SQLITE)
USE_SQLITE=	yes
.	endif
.endif

.if ${PKGNAMESUFFIX} == "-bfd"
.	if defined(WITH_LIBBFD)
RUN_DEPENDS=	${LOCALBASE}/lib/libbfd.a:${PORTSDIR}/devel/libbfd
.	endif
.endif

.if ${PKGNAMESUFFIX} == "-fftw"
.	if defined(WITH_FFTW)
LIB_DEPENDS=	fftw3.4:${PORTSDIR}/math/fftw3
.	endif
.endif

.if ${PKGNAMESUFFIX} == "-forms"
.	if defined(WITH_XFORMS)
LIB_DEPENDS=	forms.1:${PORTSDIR}/x11-toolkits/xforms
.	endif
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-fcl-db"
OPT+=	-Fuunits/${ARCH}-freebsd -Fu../units/${ARCH}-freebsd \
	-Fu../src -Fu../../units/${ARCH}-freebsd -Fu../../../units/${ARCH}-freebsd
HAVE_EXAMPLES=  true
.endif

.if ${PKGNAMESUFFIX} == "-fcl-net"
OPT+=	-Fu${WRKDIR}/${WRKUNITDIR}/*
.endif

.if ${PKGNAMESUFFIX} == "-fpgtk"
.	if defined(WITH_GTK1)
.include <${PORTSDIR}/Mk/bsd.gnome.mk>
USE_GNOME=	gtk12
.	endif
.endif

.if ${PKGNAMESUFFIX} == "-fv"
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-gconf"
.	if defined(WITH_GCONF)
.include <${PORTSDIR}/Mk/bsd.gnome.mk>
USE_GNOME=      gconf
.	endif
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-gdbm"
.	if defined(WITH_GDBM)
LIB_DEPENDS=	gdbm.3:${PORTSDIR}/databases/gdbm
.	endif
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-ggi"
.	if defined(WITH_LIBGGI)
LIB_DEPENDS=	ggi:${PORTSDIR}/graphics/libggi
.	endif
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-gtk"
.	if defined(WITH_GTK1)
.include <${PORTSDIR}/Mk/bsd.gnome.mk>
USE_GNOME=	gtk12
.	endif
HAVE_EXAMPLES=	true
OPT+=-Fu${WRKDIR}/${WRKUNITDIR}/*
.endif

.if ${PKGNAMESUFFIX} == "-gtk2"
.	if defined(WITH_GTK2)
.include <${PORTSDIR}/Mk/bsd.gnome.mk>
USE_GNOME=	gtk20
.	endif
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-hash"
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-httpd"
.	if defined(WITH_APACHE12)
USE_APACHE=	13
.	endif
.	if defined(WITH_APACHE20)
USE_APACHE=	20
.	endif
.	if defined(WITH_APACHE22)
USE_APACHE=	22
.	endif
.endif

.if ${PKGNAMESUFFIX} == "-imlib"
.	if defined(WITH_IMLIB)
.include <${PORTSDIR}/Mk/bsd.gnome.mk>
USE_GNOME=	imlib
.	endif
.endif

.if ${PKGNAMESUFFIX} == "-cairo"
.	if defined(WITH_LIBCAIRO)
LIB_DEPENDS=	cairo.2:${PORTSDIR}/graphics/cairo
.	endif
.endif

.if ${PKGNAMESUFFIX} == "-libcurl"
.	if defined(WITH_LIBCURL)
LIB_DEPENDS=	curl.4:${PORTSDIR}/ftp/curl
.	endif
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-libgd"
.	if defined(WITH_LIBGD)
LIB_DEPENDS=	gd.4:${PORTSDIR}/graphics/gd
.	endif
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-libpng"
.	if defined(WITH_LIBPNG)
LIB_DEPENDS=	png.5:${PORTSDIR}/graphics/png
.	endif
.endif

.if ${PKGNAMESUFFIX} == "-ncurses"
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-netdb"
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-opengl"
.	if defined(WITH_OPENGL)
USE_GL=		yes
LIB_DEPENDS=	glut.4:${PORTSDIR}/graphics/libglut
.	endif
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-openssl"
.       if defined(WITH_OPENSSL)
USE_OPENSSL=	yes
.       endif
.endif

.if ${PKGNAMESUFFIX} == "-pcap"
.	if defined(WITH_LIBPCAP)
LIB_DEPENDS=    pcap:${PORTSDIR}/net/libpcap
.	endif
.endif

.if ${PKGNAMESUFFIX} == "-svgalib"
.	if defined(WITH_SVGA)
LIB_DEPENDS=	vga.1:${PORTSDIR}/graphics/svgalib
.	endif
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-syslog"
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-tcl"
.	if defined(WITH_TCL)
RUN_DEPENDS=	wish8.4:${PORTSDIR}/x11-toolkits/tk84
.	endif
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-unzip"
.	if defined(WITH_UNZIP)
RUN_DEPENDS=	unzip:${PORTSDIR}/archivers/unzip
.	endif
.endif

.if ${PKGNAMESUFFIX} == "-utils"
OPT+=-Fu../fcl/*
.endif

.if ${PKGNAMESUFFIX} == "-utmp"
HAVE_EXAMPLES=	true
.endif

.if ${PKGNAMESUFFIX} == "-x11"
.	if defined(WITH_X11)
USE_XLIB=	yes
.	endif
.endif

.if ${PKGNAMESUFFIX} == "-zvt"
.	if defined(WITH_ZVT)
.include <${PORTSDIR}/Mk/bsd.gnome.mk>
USE_GNOME=	libzvt
.	endif
HAVE_EXAMPLES=	true
.endif

post-extract:
	@cd ${WRKDIR}/${WRKUNITDIR} && \
		${FIND} ${WRKSRC} -type d -name .svn | ${XARGS} ${RM} -rf

post-patch:
.if ${PKGNAMESUFFIX} == "-utils"
	@${REINPLACE_CMD} -e 's|fpcm||g' ${WRKDIR}/${WRKUNITDIR}/Makefile \
		${WRKDIR}/${WRKUNITDIR}/Makefile.fpc
.endif

do-build:
	@${ECHO_CMD} ${MAKE_ENV}
	@${ECHO_CMD} ""
	@cd ${WRKDIR}/${WRKUNITDIR} && ${GMAKE} all ${MAKE_ENV}

do-install:
	@cd ${WRKDIR}/${WRKUNITDIR} && ${GMAKE} install ${MAKE_ENV}
.	if !defined(NOPORTSDOCS)
.		if defined(HAVE_EXAMPLES)
			@cd ${WRKDIR}/${WRKUNITDIR} && ${GMAKE} fpc_exampleinstall
.		endif
.	endif
